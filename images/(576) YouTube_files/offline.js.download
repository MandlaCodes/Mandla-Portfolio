(function(g){var window=this;'use strict';var cT7=function(R){var F=new g.Ad("und",new g.q3("Default","und",!0));F.captionTracks=R.captionTracks;return F},Wt7=function(R){return new g.qW(function(F,h){var a=R.length,J=[];
if(a)for(var M=function(E,B){a--;J[E]=B;a==0&&F(J)},v=function(E){h(E)},I,w=0;w<R.length;w++)I=R[w],g.ln_(I,g.Iu(M,w),v);
else F(J)})},mC=function(R){this.B=R},o5=function(){mC.apply(this,arguments)},REG=function(){o5.apply(this,arguments)},Fh4=function(){o5.apply(this,arguments)},hE4=function(){o5.apply(this,arguments)},aM6=function(){o5.apply(this,arguments)},JN9=function(){o5.apply(this,arguments)},Mpu=function(){o5.apply(this,arguments)},vXL=function(){mC.apply(this,arguments)},gX6=function(){o5.apply(this,arguments)},GBe=function(){o5.apply(this,arguments)},IM7=function(){o5.apply(this,arguments)},ii9=function(){o5.apply(this,
arguments)},wB9=function(){o5.apply(this,arguments)},EXk=function(){o5.apply(this,arguments)},BTg=function(){o5.apply(this,arguments)},rN9=function(){o5.apply(this,arguments)},Y_7=function(){o5.apply(this,arguments)},shh=function(){o5.apply(this,arguments)},pB9=function(){o5.apply(this,arguments)},kBk=function(){o5.apply(this,arguments)},Qhv=function(){mC.apply(this,arguments)},$p9=function(){o5.apply(this,arguments)},ANu=function(){o5.apply(this,arguments)},xpv=function(){o5.apply(this,arguments)},
NTg=function(){o5.apply(this,arguments)},Hiv=function(){o5.apply(this,arguments)},Lhg=function(){o5.apply(this,arguments)},TT7=function(){o5.apply(this,arguments)},yN6=function(){o5.apply(this,arguments)},q_7=function(){o5.apply(this,arguments)},fMt=function(){mC.apply(this,arguments)},jhU=function(){mC.apply(this,arguments)},Zi9=function(){mC.apply(this,arguments)},bi6=function(){o5.apply(this,arguments)},S_h=function(){o5.apply(this,arguments)},Oi9=function(){o5.apply(this,arguments)},mpL=function(){o5.apply(this,
arguments)},oXk=function(){o5.apply(this,arguments)},XBv=function(){o5.apply(this,arguments)},eE4=function(){o5.apply(this,arguments)},nXu=function(){o5.apply(this,arguments)},uz9=function(){o5.apply(this,arguments)},dpL=function(){o5.apply(this,arguments)},PEg=function(){o5.apply(this,arguments)},zEe=function(){o5.apply(this,arguments)},Kh7=function(){o5.apply(this,arguments)},tpe=function(){o5.apply(this,arguments)},lM6=function(){o5.apply(this,arguments)},Dpe=function(){o5.apply(this,arguments)},
Vpu=function(){o5.apply(this,arguments)},Uph=function(){o5.apply(this,arguments)},CEU=function(){o5.apply(this,arguments)},cNe=function(){o5.apply(this,arguments)},Whh=function(){o5.apply(this,arguments)},Rek=function(){o5.apply(this,arguments)},Fz7=function(){o5.apply(this,arguments)},heu=function(){o5.apply(this,arguments)},aR4=function(){o5.apply(this,arguments)},JVv=function(){o5.apply(this,arguments)},MRg=function(){o5.apply(this,arguments)},vAL=function(){mC.apply(this,arguments)},gA4=function(){o5.apply(this,
arguments)},Gdh=function(){o5.apply(this,arguments)},IRt=function(){o5.apply(this,arguments)},iue=function(){o5.apply(this,arguments)},wpt=function(){o5.apply(this,arguments)},EAu=function(){o5.apply(this,arguments)},BFg=function(){o5.apply(this,arguments)},rVv=function(){o5.apply(this,arguments)},Yt7=function(){o5.apply(this,arguments)},sx7=function(){o5.apply(this,arguments)},pp4=function(){o5.apply(this,arguments)},kd6=function(){o5.apply(this,arguments)},QxU=function(){o5.apply(this,arguments)},
$Te=function(){o5.apply(this,arguments)},AVe=function(){o5.apply(this,arguments)},xT7=function(){o5.apply(this,arguments)},NF6=function(){o5.apply(this,arguments)},Hue=function(){o5.apply(this,arguments)},Lz4=function(){o5.apply(this,arguments)},TF7=function(){o5.apply(this,arguments)},yVg=function(){o5.apply(this,arguments)},qte=function(){o5.apply(this,arguments)},fR7=function(){o5.apply(this,arguments)},jx4=function(){o5.apply(this,arguments)},Zug=function(){o5.apply(this,arguments)},buL=function(){o5.apply(this,
arguments)},StU=function(){o5.apply(this,arguments)},Ou7=function(){o5.apply(this,arguments)},mTu=function(){o5.apply(this,arguments)},oAg=function(){o5.apply(this,arguments)},Xpk=function(){o5.apply(this,arguments)},eeu=function(){o5.apply(this,arguments)},nA9=function(){o5.apply(this,arguments)},uR7=function(R){R=R.key||R.id;
if(!R)throw Error("Entity key is missing");return R},dT9=function(){if(X9)return X9();
var R={};X9=g.UU("PersistentEntityStoreDb",{zF:(R.EntityStore={L7:1},R.EntityAssociationStore={L7:2},R),shared:!1,upgrade:function(F,h){h(1)&&g.Zd(g.Lm(F,"EntityStore",{keyPath:"key"}),"entityType","entityType");h(2)&&(F=g.Lm(F,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Zd(F,"byParentEntityKey","parentEntityKey"),g.Zd(F,"byChildEntityKey","childEntityKey"))},
version:3});return X9()},PL7=function(R){return g.nm(dT9(),R)},ze9=function(R){return g.nm((0,g.LO6)(),R)},es=function(R){this.token=R},ny=function(R,F){F=F===void 0?{}:F;
g.Pv.call(this,g.Tsg[R],Object.assign({},{name:"PESEncoderError",type:R},F));this.type=R;this.level="WARNING";Object.setPrototypeOf(this,ny.prototype)},Kzu=function(R){return new ny("WRONG_DATA_TYPE",{Wl:R})},tRe=function(R){return R instanceof Error?new ny("UNKNOWN_ENCODE_ERROR",{originalMessage:R.message}):new ny("UNKNOWN_ENCODE_ERROR")},lRu=function(R){return R instanceof Error?new ny("UNKNOWN_DECODE_ERROR",{originalMessage:R.message}):new ny("UNKNOWN_DECODE_ERROR")},DT7=function(R,F){R=R instanceof
ny?R:F(R);
g.y7(R);throw R;},VRL=function(){},UTv=function(R,F,h){try{return R.K(F,h)}catch(a){DT7(a,tRe)}},CL4=function(R){R=(new TextEncoder).encode(R).subarray(0,16);
var F=new Uint8Array(16);F.set(R);return F},uP=function(R){this.B=R},Wze=function(R){var F=cV7[R];
if(F)return F;g.qN(new g.Pv("Entity model not found.",{entityType:R}))},Rq7=function(R,F){this.B=R;
this.D=F;this.K={}},hqk=function(R,F){a:{R=F74(R.D,F.version);
try{var h=R.D(F.data,F.key);break a}catch(a){DT7(a,lRu)}h=void 0}return h},dN=function(R,F,h){return R.B.objectStore("EntityStore").get(F).then(function(a){if(a){if(h&&a.entityType!==h)throw Error("Incorrect entity type");
return hqk(R,a)}})},Po=function(R,F,h){return h?(h=h.map(function(a){return dN(R,a,F)}),g.Qe.all(h)):R.B.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(F)).then(function(a){return a.map(function(J){return hqk(R,J)})})},Ky=function(R,F,h){var a=uR7(F),J=F74(R.D,1),M=Object.assign({},F);
return R.B.objectStore("EntityStore").get(a).then(function(v){if(v){if(v.entityType!==h)throw Error("Incorrect entity type");M.entityMetadata||(v=hqk(R,v),M.entityMetadata=v.entityMetadata)}}).then(function(){var v={key:a,
entityType:h,data:UTv(J,M,a),version:1};return g.Qe.all([g.qU(R.B.objectStore("EntityStore"),v),aH6(R,M,h)])}).then(function(){zh(R,a,h);
return a})},Jh7=function(R,F,h){F=F.map(function(a){return Ky(R,a,h)});
return g.Qe.all(F)},t8=function(R,F,h){if(h==null?0:h.QM){var a=new Set;
return MVk(R,F,a).then(function(){for(var M=[],v=g.N(a),I=v.next();!I.done;I=v.next())M.push(t8(R,I.value));return g.Qe.all(M).then(function(){})})}var J=g.lp(F).entityType;
return g.Qe.all([R.B.objectStore("EntityStore").delete(F),va7(R,F)]).then(function(){zh(R,F,J)})},ga7=function(R,F){return g.mF(R.B.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(F)},function(h){return g.Qe.all([h.delete(),
va7(R,h.cursor.primaryKey)]).then(function(){zh(R,h.cursor.primaryKey,F);return g.S1(h)})})},G3u=function(R,F,h,a){var J=F74(R.D,1);
return dN(R,F,a).then(function(M){if(M){M=g.F_(M,h);var v={key:F,entityType:a,data:UTv(J,M,F),version:1};return g.Qe.all([g.qU(R.B.objectStore("EntityStore"),v),aH6(R,M,a)])}}).then(function(){zh(R,F,a);
return F})},zh=function(R,F,h){var a=R.K[h];
a||(a=new Set,R.K[h]=a);a.add(F)},IHG=function(R,F,h){var a=uR7(F);
h=Wze(h);if(!h)return g.Qe.resolve([]);h=new h(F);R=R.B.objectStore("EntityAssociationStore");F=[];h=g.N(h.D());for(var J=h.next();!J.done;J=h.next())F.push(g.qU(R,{parentEntityKey:a,childEntityKey:J.value}));return g.Qe.all(F).then(function(M){return M.map(function(v){return v[1]})})},va7=function(R,F){return R.B.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(F))},aH6=function(R,F,h){var a=uR7(F);
return va7(R,a).then(function(){return IHG(R,F,h)})},MVk=function(R,F,h){if(h.has(F))return g.Qe.resolve(void 0);
h.add(F);return iJu(R,F).then(function(a){return R.B.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(F)).then(function(){return a})}).then(function(a){var J=g.Qe.resolve(void 0);
a=g.N(a);for(var M=a.next(),v={};!M.done;v={U_:void 0},M=a.next())v.U_=M.value,J=J.then(function(I){return function(){return MVk(R,I.U_,h)}}(v));
return J}).then(function(){})},iJu=function(R,F){var h=R.B.objectStore("EntityAssociationStore");
return h.index("byParentEntityKey").getAll(IDBKeyRange.only(F)).then(function(a){var J=[];a=g.N(a);for(var M=a.next();!M.done;M=a.next())M=M.value,J.push(h.index("byChildEntityKey").getAll(M.childEntityKey));return g.Qe.all(J)}).then(function(a){var J=[];
a=g.N(a);for(var M=a.next();!M.done;M=a.next())M=M.value,M.length===1&&J.push(M[0].childEntityKey);return J})},lP=function(){},wL6=function(){this.B={};
this.B[0]=new lP;if(!g.pR("aes_pes_encoder_killswitch")){var R=this.B;try{var F=g.zP();var h=CL4(F);var a=new uP(new g.iU(h),new g.IZ(h))}catch(J){throw R=J instanceof Error?new ny("KEY_CREATION_FAILED",{originalMessage:J.message}):new ny("KEY_CREATION_FAILED"),g.y7(R),R;}R[1]=a}},F74=function(R,F){F=F===void 0?0:F;
R=R.B[F];if(!R)throw F=new ny("INVALID_ENCODER_VERSION",{Wl:F}),g.y7(F),F;return R},De=function(R,F){g.d.call(this);
this.token=R;this.B=F;this.observers=[];R=new g.Wi.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.zP());R.onmessage=this.D.bind(this);this.channel=R},VR=function(R,F,h){var a,J,M,v;
return g.u(function(I){if(I.D==1)return g.m(I,PL7(R.token),2);if(I.D!=3)return a=I.B,g.m(I,g.ye(a,["EntityStore","EntityAssociationStore"],F,function(w){J=new Rq7(w,R.B);return h(J)}),3);
M=I.B;J&&(v=J.K,Object.keys(v).length>0&&(R.channel.postMessage(v),Eag(R,v)));return I.return(M)})},U9=function(R,F,h){return VR(R,{mode:"readwrite",
qt:!0},function(a){return Ky(a,F,h)})},Bq7=function(R,F){return VR(R,{mode:"readwrite",
qt:!0},function(h){return Jh7(h,F,"offlineOrchestrationActionWrapperEntity")})},rhU=function(R,F){return VR(R,{mode:"readwrite",
qt:!0},function(h){return t8(h,F)})},YLL=function(R){return VR(R,{mode:"readwrite",
qt:!0},function(F){return ga7(F,"videoPlaybackPositionEntity")})},Cy=function(R,F,h){return VR(R,{mode:"readonly",
qt:!0},function(a){return dN(a,F,h)})},co=function(R,F,h){return VR(R,{mode:"readonly",
qt:!0},function(a){return Po(a,F,h)})},Eag=function(R,F){R=g.N(R.observers);
for(var h=R.next();!h.done;h=R.next())h=h.value,h(F)},s2v=function(){var R,F,h;
return g.u(function(a){if(a.D==1)return g.Hi(a,2),g.m(a,g.Dd(),4);if(a.D!=2){R=a.B;if(!R||!g.Kn()||typeof g.Wi.BroadcastChannel==="undefined")return a.return();F=new wL6;return a.return(new De(R,F))}h=g.f_(a);h instanceof Error&&g.y7(h);return a.return()})},Wo=function(){pLL||(pLL=s2v());
return pLL},k37=function(R){var F;
R=(F=R.options)==null?void 0:F.persistenceOption;return R==="ENTITY_PERSISTENCE_OPTION_PERSIST"||R==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},Q2G=function(R){var F;
return g.u(function(h){return h.D==1?g.m(h,Wo(),2):(F=h.B)?g.m(h,VR(F,"readwrite",function(a){for(var J={},M=g.N(R),v=M.next(),I={};!v.done;I={P1:void 0,A8:void 0},v=M.next())I.P1=v.value,I.P1.entityKey&&k37(I.P1)&&(I.A8=g.vV(I.P1.payload),v=void 0,I.P1.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(v=function(w){return function(){return Ky(a,w.P1.payload[w.A8],w.A8)}}(I)),I.P1.type==="ENTITY_MUTATION_TYPE_DELETE"&&(v=function(w){return function(){return t8(a,w.P1.entityKey)}}(I)),I.P1.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(v=function(w){return function(){return G3u(a,w.P1.entityKey,w.P1.payload[w.A8],w.A8)}}(I)),v&&(J[I.P1.entityKey]=J[I.P1.entityKey]?J[I.P1.entityKey].then(v):v()));
return g.Qe.all(Object.values(J))}),0):h.return()})},$Wt=function(R){var F;
return g.u(function(h){if(h.D==1){F=R.mutations;if(!F||F.length<=0)return h.return();if(g.YF){var a={type:"ENTITY_LOADED"};F!==void 0&&(a.payload=F);g.YF.dispatch(a)}return g.m(h,Q2G(F),2)}F.length=0;g.Na(h)})},AhL=function(R){return R!==void 0},xW4=function(R){var F=g.zy();
F=Object.assign({},F);R=Object.assign({},R);for(var h in F)R[h]?(F[h]!==4&&(F[h]=R[h]),delete R[h]):F[h]!==2&&(F[h]=4);Object.assign(F,R);g.$0I(F);JSON.stringify(F);return F},Nqu=function(R){var F,h;
return g.u(function(a){if(a.D==1)return g.m(a,g.Dd(),2);if(a.D!=3)return(F=a.B)?g.m(a,g.lg(F),3):a.return();h=a.B;return a.return(g.ye(h,["index","media","captions"],{mode:"readwrite",qt:!0},function(J){var M=IDBKeyRange.bound(R+"|",R+"~");J=[J.objectStore("index").delete(M),J.objectStore("media").delete(M),J.objectStore("captions").delete(M)];return g.Qe.all(J).then(function(){})}))})},HJh=function(){var R,F;
return g.u(function(h){if(h.D==1)return g.m(h,g.Dd(),2);if(h.D!=3){R=h.B;if(!R)throw g.pm("rvdfd");return g.m(h,g.lg(R),3)}F=h.B;return h.return(g.ye(F,["index","media"],{mode:"readwrite",qt:!0},function(a){var J={};return g.bI(a.objectStore("index"),{},function(M){var v=M.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),I=g.Qe.resolve(void 0);if(v){var w=v[1];v=v[2];J[w]=J[w]||{};var E;J[w][v]=g.L1I((E=M.getValue())==null?void 0:E.fmts)}else I=M.delete().then(function(){});
return g.Qe.all([g.S1(M),I]).then(function(B){return g.N(B).next().value})}).then(function(){for(var M={},v=g.N(Object.keys(J)),I=v.next();!I.done;I=v.next()){I=I.value;
var w=J[I].v;M[I]=J[I].a&&w?1:2}var E=xW4(M);return g.qX2(a.objectStore("media"),{},function(B){var r=B.cursor.key.match(g.fA_);r&&M[r[1]]||a.objectStore("media").delete(B.cursor.key);return g.Q3T(B)}).then(function(){return E})})}))})},L7G=function(R,F){var h,a;
return g.u(function(J){if(J.D==1)return g.m(J,g.Dd(),2);if(J.D!=3){h=J.B;if(!h)throw g.pm("wct");return g.m(J,g.lg(h),3)}a=J.B;return g.m(J,g.ye(a,["captions"],{mode:"readwrite",qt:!0},function(M){var v=[];M=M.objectStore("captions");for(var I=0;I<F.length;I++){var w=g.qU(M,F[I],R+"|"+F[I].metadata.vss_id);v.push(w)}return g.Qe.all(v)}),0)})},Tqh=function(R){var F,h,a;
return g.u(function(J){if(J.D==1)return F=IDBKeyRange.bound(R+"|",R+"~"),g.m(J,g.Dd(),2);if(J.D!=3){h=J.B;if(!h)throw g.pm("gactfv");return g.m(J,g.lg(h),3)}a=J.B;return J.return(a.getAll("captions",F))})},yhG=function(R){return g.u(function(F){g.tJ(R,0);
return F.return(Nqu(R))})},qLv=function(R){return{context:g.l5(),
videoIds:R}},fHe=function(R){return{context:g.l5(),
playlistIds:R}},j2h=function(R){return{context:g.l5(),
offlinePlaylistSyncChecks:R}},ZJ4=function(){this.B=new Map},SLL=function(){bJL||(bJL=new ZJ4);
return bJL},OJ7=function(R,F){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:R},metadata:F,statusCode:void 0,csn:void 0,can:void 0}},mWL=function(R,F,h){if(!h){var a=a===void 0?!1:a;
h=R.B.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!h||a)h=g.sY(16),R.B.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",h)}R={flowNonce:h,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:F.eventType};F.metadata&&(R.flowMetadata=F.metadata);F.statusCode!==void 0&&(R.flowEventStatus=F.statusCode);F.csn&&(R.csn=F.csn);F.can&&(R.can=F.can);g.MU("flowEvent",R,void 0)},oag=function(R){var F,h,a,J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O,n,K,Rg,U,vi,GI,gL,Em,hf,qa,m2,Ru,ng,$7,eB,ch,Y7,Kg,hX,f,Xl;
return g.u(function(b9){if(b9.D==1)return g.m(b9,VR(R,{mode:"readonly",qt:!0},function(ag){return Po(ag,"playbackData").then(function(fg){var L=fg.map(function(u9){return u9.transfer}).filter(function(u9){return!!u9}),Fi=fg.map(function(u9){return u9.offlineVideoPolicy}).filter(function(u9){return!!u9}),KM=fg.filter(function(u9){return!!u9.key}).map(function(u9){return g.DI(g.lp(u9.key).entityId,"downloadStatusEntity")});
L=Po(ag,"transfer",L);Fi=Po(ag,"offlineVideoPolicy",Fi);KM=Po(ag,"downloadStatusEntity",KM);var gU=L.then(function(u9){u9=u9.reduce(function(K_,ci){(ci==null?0:ci.offlineVideoStreams)&&K_.push.apply(K_,g.S(ci.offlineVideoStreams));return K_},[]).filter(function(K_){return!!K_});
return Po(ag,"offlineVideoStreams",u9)});
return g.Qe.all([L,Fi,gU,KM]).then(function(u9){var K_=g.N(u9);u9=K_.next().value;var ci=K_.next().value;var CM=K_.next().value;K_=K_.next().value;return[fg,u9,ci,CM,K_]})})}),2);
if(b9.D!=3)return F=b9.B,g.m(b9,VR(R,{mode:"readonly",qt:!0},function(ag){return Po(ag,"mainDownloadsListEntity").then(function(fg){var L,Fi;return(Fi=(L=fg[0])==null?void 0:L.downloads)!=null?Fi:[]})}),3);
h=b9.B;a=g.N(F);J=a.next().value;M=a.next().value;v=a.next().value;I=a.next().value;w=a.next().value;E=J;B=M;r=v;Y=I;p=w;k={};H={};T={};Z={};b={};O=[];n=g.N(B);for(K=n.next();!K.done;K=n.next())(Rg=K.value)&&(k[Rg.key]=Rg);U=g.N(r);for(vi=U.next();!vi.done;vi=U.next())(GI=vi.value)&&(H[GI.key]=GI);gL=g.N(p);for(Em=gL.next();!Em.done;Em=gL.next())(hf=Em.value)&&(T[hf.key]=hf);qa=g.N(Y);for(m2=qa.next();!m2.done;m2=qa.next())(Ru=m2.value)&&(Z[Ru.key]=Ru);ng=g.N(h);for($7=ng.next();!$7.done;$7=ng.next())eB=
$7.value,ch=void 0,b[(ch=eB.videoItem)!=null?ch:""]=!0,eB.videoItem&&(Kg=Y7=void 0,hX=(Kg=(Y7=g.lp(eB.videoItem))==null?void 0:Y7.entityId)!=null?Kg:"",O.push({externalVideoId:hX}));f=E.filter(function(ag){if(!ag||!ag.key||!ag.offlineVideoPolicy)return!1;ag=g.lp(ag.key).entityId;ag=g.DI(ag,"downloadStatusEntity");var fg;return!(ag&&((fg=T[ag])==null?void 0:fg.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
Xl=f.map(function(ag){var fg=k[ag.transfer],L=[];if(fg==null?0:fg.offlineVideoStreams)for(var Fi=g.N(fg.offlineVideoStreams),KM=Fi.next();!KM.done;KM=Fi.next())(KM=Z[KM.value])&&L.push(KM);Fi=H[ag.offlineVideoPolicy];KM=b;var gU=ag==null?void 0:ag.playerResponseTimestamp,u9=g.lp(Fi.key).entityId;ag=g.DI(u9,"mainVideoEntity");if(Fi.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var K_="OFFLINE_VIDEO_STATE_DISABLED";Fi.expirationTimestamp&&Number(Fi.expirationTimestamp)<Date.now()/1E3&&(K_="OFFLINE_VIDEO_STATE_EXPIRED")}else if(Fi.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")K_="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(fg==null?void 0:fg.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":K_="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":K_="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":K_="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":K_="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":K_="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":K_="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:K_="OFFLINE_VIDEO_STATE_UNKNOWN"}if(K_==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(fg==null?void 0:fg.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":K_="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":K_="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":K_=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}u9={id:u9,videoState:K_};if(fg==null?0:fg.cotn)u9.cotn=fg.cotn;if(fg==null?0:fg.maximumDownloadQuality)u9.selectedVideoQuality=fg==null?void 0:fg.maximumDownloadQuality;if(fg==null?0:fg.lastProgressTimeMs)u9.lastProgressTimeMs=fg.lastProgressTimeMs;gU&&(u9.playerResponseSavedTimeMs=String(Number(gU)*1E3));fg=String;gU=0;L=g.N(L);for(K_=L.next();!K_.done;K_=L.next())if(K_=K_.value,K_.streamsProgress){K_=g.N(K_.streamsProgress);for(var ci=K_.next();!ci.done;ci=K_.next()){var CM=
void 0;gU+=Number((CM=ci.value.numBytesDownloaded)!=null?CM:0)}}u9.downloadedBytes=fg(gU);u9.selectedOfflineMode=KM[ag]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";Fi.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(u9.offlinePlaybackDisabledReason=Fi.offlinePlaybackDisabledReason);return u9});
return b9.return({offlineVideos:Xl,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:O}}})})},XL4=function(){this.locks=navigator.locks},eqt=function(){try{var R=g.hG("ytglobal.locks_");
if(R)return R;var F;if(F=navigator){var h=navigator;F="locks"in h&&!!h.locks}if(F)return g.Wi.localStorage&&g.Wi.localStorage.getItem("noop"),R=new XL4,g.Fk("ytglobal.locks_",R),R}catch(a){}},Rn=function(){},naL=function(){},uNe=function(R){if(R.includes(":"))throw Error("Invalid user cache name: "+R);
return R+":"+g.zP("CacheStorage get")},dWU=function(){return g.u(function(R){if(Fb!==void 0)return R.return(Fb);
Fb=new Promise(function(F){var h;return g.u(function(a){switch(a.D){case 1:return g.Hi(a,2),g.m(a,hK.open("test-only"),4);case 4:return g.m(a,hK.delete("test-only"),5);case 5:g.yn(a,3);break;case 2:if(h=g.f_(a),h instanceof Error&&h.name==="SecurityError")return F(!1),a.return();case 3:F("caches"in window),g.Na(a)}})});
return R.return(Fb)})},zqv=function(){return g.u(function(R){if(R.D==1)return g.m(R,dWU(),2);
if(!R.B)return R.return(void 0);PeU||(PeU=new naL);return R.return(PeU)})},an=function(R,F,h){g.qN(new g.Pv("Woffle: "+R,h?{cotn:h}:""));
F instanceof Error&&g.qN(F)},K74=function(R){var F;
return g.u(function(h){if(h.D==1)return g.m(h,oag(R),2);F=h.B;g.MU("offlineStateSnapshot",F);g.Na(h)})},JK=function(R){g.d.call(this);
var F=this;this.api=R;this.rf={bPI:function(){return F.B},
Dhu:function(){return F.D}};
typeof g.Wi.BroadcastChannel!=="undefined"&&(this.B=new g.Wi.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.zP()),this.B.onmessage=this.K.bind(this),this.D=new g.Wi.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.zP()),this.D.onmessage=this.L.bind(this))},MB=function(R,F){R.api.WG("onOfflineOperationFailure",F);
var h;(h=R.B)==null||h.postMessage(F)},tVU=function(R,F,h,a){var J=this;
this.Z=R;this.C=F;this.visibility=h;this.X=a;this.N=this.Y=this.S=this.K=this.B=!1;this.L=new g.DY(function(){J.MR()});
this.rf={Dp:function(){return J.D},
MR:function(){J.MR()},
fsz:function(){return J.L}};
this.visibility.subscribe("visibilitystatechange",function(){J.u0()})},lHk=function(R){if(!R.K&&!R.B){var F=eqt();
if(F){R.K=!0;var h=g.zP("OfflineLockManager");F.request("woffle_orchestration_leader:"+h,{},function(){var a,J,M,v;return g.u(function(I){switch(I.D){case 1:return g.Hi(I,2),R.D=new g.EJ,R.B=!0,R.K=!1,g.m(I,R.Z(),4);case 4:return g.m(I,R.D.promise,5);case 5:g.yn(I,0);break;case 2:a=g.f_(I),((M=(J=R).X)==null?0:M.call(J,"wo_relinquish_leadership_on_lock_request_error"))||R.MR(),a instanceof Error&&(v=a,v.args=[{name:"WoLockManagerError",Q8:a.name}],g.y7(v)),g.Na(I)}})})}}},DWe=function(R){R.B&&(R.N=
!0,v0(R))},VVk=function(R,F){R.B&&(R.S=F,v0(R))},UWk=function(R,F){R.B&&(R.Y=F,v0(R))},v0=function(R){R.Y&&R.S&&R.N&&R.visibility.isBackground()?g.VI(R.L,6E4):R.L.stop()},gx=function(R){var F;
R.offlineDeleteReason=(F=R.offlineDeleteReason)!=null?F:"OFFLINE_DELETE_REASON_UNKNOWN";var h;R.offlineModeType=(h=R.offlineModeType)!=null?h:"OFFLINE_NOW";g.MU("offlineDeleteEvent",R)},GO=function(R,F){var h=F.videoId;
var a=F.jy;F=F.offlineModeType;R.encryptedVideoId=h;R.cotn=a==null?void 0:a.cotn;R.offlineabilityFormatType=a==null?void 0:a.maximumDownloadQuality;var J;R.isRefresh=(J=a==null?void 0:a.isRefresh)!=null?J:!1;var M;R.softErrorCount=(M=a==null?void 0:a.transferRetryCount)!=null?M:0;R.offlineModeType=F!=null?F:"OFFLINE_NOW";(R.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&R.statusType==="UNKNOWN_STATUS_TYPE"||!R.transferStatusType&&!R.statusType)&&g.qN(Error("Woffle unknown transfer status"));
g.MU("offlineTransferStatusChanged",R)},Ce6=function(R){GO({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},R)},chG=function(R,F,h,a){a={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!a};F&&h&&(F=Math.floor(F/1024).toFixed(),h=Math.floor(h/1024).toFixed(),a.alreadyDownloadedKbytes=F,a.totalFetchedKbytes=F,a.totalContentKbytes=h);GO(a,R)},W76=function(R){GO({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},R)},Rvh=function(R){GO({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},R)},FWh=function(R){switch(R){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
In=function(R){var F,h,a;
return((a=(F=R.actionMetadata)==null?void 0:(h=F.retryScheduleIntervalsInSeconds)==null?void 0:h.length)!=null?a:0)>0},i$=function(R){return R.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!R.entityKey},wx=function(R){return R.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!R.entityKey},Eh=function(R){return R.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!R.entityKey},hv7=function(R){return R.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!R.entityKey},
B0=function(R,F,h,a,J){J=J===void 0?!1:J;
var M,v,I,w,E,B;return g.u(function(r){if(r.D==1)return M=g.DI(R,F),v=g.DI(R,"downloadStatusEntity"),g.m(r,VR(h,{mode:"readonly",qt:!0},function(Y){return g.Qe.all([dN(Y,M,F),dN(Y,v,"downloadStatusEntity")])}),2);
I=r.B;w=I.length?I[0]:void 0;if(!w)return r.G$(0);E=a_L;if(B=I.length>1?I[1]:void 0){if(B.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!J)return r.return();B.downloadState=a}else B={key:v,downloadState:a};g.S2(w,E,B);return g.m(r,VR(h,{mode:"readwrite",qt:!0},function(Y){return g.Qe.all([Ky(Y,w,F),Ky(Y,B,"downloadStatusEntity")])}),0)})},rx=function(R,F){return R.actionType===F.actionType&&R.entityKey===F.entityKey},YD=function(R,F){if(R&&R.transferState!=="TRANSFER_STATE_COMPLETE"&&R.transferState!==
"TRANSFER_STATE_FAILED"){var h=g.lp(R.key).entityId;
GO({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:h,jy:R,offlineModeType:F})}},sh=function(R){if(!R||!R.thumbnails)return[];
var F=[];R=g.N(R.thumbnails);for(var h=R.next();!h.done;h=R.next())h=h.value,h.url&&F.push(h.url);return F},J1h=function(R,F,h){h=h===void 0?[]:h;
var a,J,M,v,I,w,E,B,r,Y,p,k,H;return g.u(function(T){if(T.D==1)return h.length?g.m(T,co(R,F),2):T.return([]);a=T.B;J=new Set;M=g.N(a);for(v=M.next();!v.done;v=M.next())if(I=v.value,w=I.id||I.key)E=g.lp(w).entityId,J.add(E);B=[];r=g.N(h);for(Y=r.next();!Y.done;Y=r.next())p=Y.value,k=p.offlineVideoData,H=void 0,((H=k)==null?0:H.videoId)&&!J.has(k.videoId)&&B.push(p);return T.return(B)})},MkU=function(R,F,h){return new g.Mz(R,{cotn:F,
raw_player_response:h,download_media:!0,start:Infinity,disable_watch_next:!0})},vyU=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},pN=function(R,F,h,a,J,M,v,I,w,E,B){this.entityType=R;
this.actionId=F;this.action=h;this.parentActionId=a;this.rootActionId=J===void 0?F:J;this.childActionIds=M;this.prereqActionId=v;this.postreqActionIds=I;this.hasChildActionFailed=E;this.retryScheduleIndex=0;this.B=B||Date.now();this.retryScheduleIndex=w||0},kD=function(R){if(!R.key)throw Error("Entity key is required.");
if(!R.actionProto)throw Error("OfflineOrchestrationAction is required.");var F=g.lp(R.key),h=g.lp(R.actionProto.entityKey);return new pN(h.entityType,F.entityId,R.actionProto,R.parentActionId,R.rootActionId,R.childActionIds,R.prereqActionId,R.postreqActionIds,R.retryScheduleIndex,R.hasChildActionFailed,Number(R.enqueueTimeSec)*1E3)},Qy=function(R){return{key:g.DI(R.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:R.action,parentActionId:R.parentActionId,rootActionId:R.rootActionId,childActionIds:R.childActionIds,prereqActionId:R.prereqActionId,postreqActionIds:R.postreqActionIds,retryScheduleIndex:R.retryScheduleIndex,hasChildActionFailed:R.hasChildActionFailed,enqueueTimeSec:(R.B/1E3).toFixed()}},gyt=function(){var R;
return g.u(function(F){return F.D==1?g.m(F,zqv(),2):(R=F.B)?F.return(R.delete("yt-player-local-img")):F.return(!0)})},$D=function(R){var F,h;
return g.u(function(a){if(a.D==1)return g.m(a,zqv(),2);if(a.D!=3){F=a.B;if(!F)throw Error("Cache API not supported");return R.length?g.m(a,F.open("yt-player-local-img"),3):a.return()}h=a.B;return g.m(a,Promise.all(R.map(function(J){return h.delete(J)})),0)})},AK=function(R){var F,h;
return g.u(function(a){if(a.D==1)return g.m(a,zqv(),2);if(a.D!=3){F=a.B;if(!F)throw Error("Cache API not supported");return R.length?g.m(a,F.open("yt-player-local-img"),3):a.return()}h=a.B;return g.m(a,h.addAll(R),0)})},xD=function(R,F,h,a,J){var M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O,n,K,Rg,U,vi,GI,gL,Em,hf,qa,m2,Ru,ng,$7,eB,ch;
return g.u(function(Y7){switch(Y7.D){case 1:return M=g.DI(R,"mainVideoEntity"),v=g.DI(R,"ytMainChannelEntity"),I=g.DI(R,"transfer"),w=g.DI(R,"videoDownloadContextEntity"),g.m(Y7,VR(F,{mode:"readonly",qt:!0},function(Kg){return g.Qe.all([dN(Kg,M,"mainVideoEntity"),dN(Kg,v,"ytMainChannelEntity"),dN(Kg,I,"transfer"),dN(Kg,w,"videoDownloadContextEntity"),Po(Kg,"ytMainChannelEntity"),Po(Kg,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:E=Y7.B;B=g.N(E);r=B.next().value;Y=B.next().value;p=B.next().value;k=B.next().value;H=B.next().value;T=B.next().value;Z=r;b=Y;O=p;n=k;K=H;Rg=T;if(!Z&&!b){Y7.G$(3);break}U=Z?sh(Z.thumbnail):[];if(!b){vi=[];Y7.G$(4);break}return g.m(Y7,Gnv(b,K),5);case 5:vi=Y7.B;case 4:return GI=vi,g.m(Y7,$D(U.concat(GI)),3);case 3:gL=[];Em=g.DI(R,"downloadStatusEntity");hf=g.N(Rg);for(qa=hf.next();!qa.done;qa=hf.next())m2=qa.value,Ru=g.lp(m2.key).entityId,ng=kD(m2),$7=g.lp(ng.action.entityKey).entityId,Ru!==
R&&$7!==R||rx(h,m2.actionProto)||gL.push(m2.key);return g.m(Y7,VR(F,{mode:"readwrite",qt:!0},function(Kg){var hX=gL.map(function(f){return t8(Kg,f)});
hX.push(t8(Kg,M,{QM:!0}));hX.push(t8(Kg,Em,{QM:!0}));return g.Qe.all(hX)}),7);
case 7:ch=(eB=n)==null?void 0:eB.offlineModeType,J&&(gx(J),J.offlineModeType&&(ch=J.offlineModeType)),YD(O,ch),MB(a,{entityKey:M,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Na(Y7)}})},wYh=function(R,F,h,a){var J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O,n,K,Rg,U,vi,GI,gL,Em,hf,qa,m2,Ru,ng,$7,eB,ch,Y7,Kg,hX,f,Xl,b9,ag,fg,L,Fi,KM,gU,u9,K_,ci,CM,eP,y;
return g.u(function(x){switch(x.D){case 1:return J=g.DI(R,"mainPlaylistEntity"),M=g.DI(R,"ytMainChannelEntity"),g.m(x,VR(F,{mode:"readonly",qt:!0},function(q){return g.Qe.all([dN(q,J,"mainPlaylistEntity"),dN(q,M,"ytMainChannelEntity"),Po(q,"mainPlaylistEntity"),Po(q,"mainDownloadsListEntity"),Po(q,"ytMainChannelEntity"),Po(q,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:v=x.B;I=g.N(v);w=I.next().value;E=I.next().value;B=I.next().value;r=I.next().value;Y=I.next().value;p=I.next().value;k=w;H=E;T=B;Z=r;b=Y;O=p;if(!k&&!H){x.G$(3);break}n=k?I_v(k):[];if(!H){K=[];x.G$(4);break}return g.m(x,Gnv(H,b),5);case 5:K=x.B;case 4:return Rg=K,g.m(x,$D(n.concat(Rg)),3);case 3:U=[];vi=new Map;if(!k){x.G$(7);break}return g.m(x,iV7(k,T,Z),8);case 8:U=x.B;GI=g.N(U);for(gL=GI.next();!gL.done;gL=GI.next())Em=gL.value,vi.set(Em,{videoId:Em,playlistId:R,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.m(x,VR(F,{mode:"readonly",qt:!0},function(q){return g.Qe.all([Po(q,"transfer"),Po(q,"videoDownloadContextEntity")])}),9);
case 9:hf=x.B;qa=g.N(hf);m2=qa.next().value;Ru=qa.next().value;ng=m2;$7=Ru;eB=g.N(ng);for(ch=eB.next();!ch.done;ch=eB.next())Y7=ch.value,Kg=g.lp(Y7.key).entityId,(hX=vi.get(Kg))&&Y7&&(hX.cotn=Y7.cotn);f=g.N($7);for(Xl=f.next();!Xl.done;Xl=f.next())b9=Xl.value,ag=g.lp(b9.key).entityId,(fg=vi.get(ag))&&b9&&(fg.offlineModeType=b9.offlineModeType);case 7:L=[];Fi=g.N(O);for(KM=Fi.next();!KM.done;KM=Fi.next())gU=KM.value,u9=g.lp(gU.key).entityId,K_=kD(gU),u9!==R&&K_.rootActionId!==R||rx(h,gU.actionProto)||
L.push(gU.key);ci=g.DI(R,"mainPlaylistEntity");return g.m(x,VR(F,{mode:"readwrite",qt:!0},function(q){var X=L.map(function(P){return t8(q,P)});
X.push(t8(q,ci,{QM:!0}));return g.Qe.all(X)}),10);
case 10:if(!k){x.G$(0);break}U.reverse();if(!U){x.G$(0);break}CM=g.N(U);eP=CM.next();case 13:if(eP.done){x.G$(0);break}y=eP.value;return g.m(x,xD(y,F,h,a,vi.get(y)),14);case 14:eP=CM.next(),x.G$(13)}})},BzG=function(R,F,h,a){var J,M,v,I,w,E,B,r,Y;
return g.u(function(p){if(p.D==1)return J=g.DI("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),M=new Map,g.m(p,VR(R,{mode:"readwrite",qt:!0},function(k){var H=Po(k,"transfer"),T=Po(k,"offlineOrchestrationActionWrapperEntity"),Z=Po(k,"videoDownloadContextEntity"),b=dN(k,J,"mainDownloadsListEntity");return g.Qe.all([H,T,Z,b]).then(function(O){O=g.N(O);var n=O.next().value;var K=O.next().value;var Rg=O.next().value;var U=O.next().value;O=Ey7.map(function(GI){return ga7(k,GI)});
K=g.N(K);for(var vi=K.next();!vi.done;vi=K.next())vi=vi.value,rx(F,vi.actionProto)||O.push(t8(k,vi.key,{QM:!0}));U&&(U.downloads=[],O.push(Ky(k,U,"mainDownloadsListEntity")));if(Rg)for(Rg=g.N(Rg),U=Rg.next();!U.done;U=Rg.next())U=U.value,K=g.lp(U.key).entityId,K=g.DI(K,"transfer"),M.set(K,U.offlineModeType);return g.Qe.all(O).then(function(){return n})})}),2);
v=p.B;I=g.N(v);for(w=I.next();!w.done;w=I.next())E=w.value,YD(E,M.get(E.key)),B=g.lp(E.key).entityId,r={videoId:B,offlineDeleteReason:a,cotn:E.cotn,offlineModeType:M.get(E.key)},gx(r),Y=g.DI(B,"mainVideoEntity"),MB(h,{entityKey:Y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.m(p,gyt(),0)})},I_v=function(R,F){var h=[];
if(R.thumbnailStyleData){R=g.N(R.thumbnailStyleData);for(var a=R.next();!a.done;a=R.next()){var J=void 0,M=void 0,v=void 0;h=h.concat(sh((J=a.value)==null?void 0:(M=J.value)==null?void 0:(v=M.collageThumbnail)==null?void 0:v.coverThumbnail))}}F=sh(F);return h.concat(F)},iV7=function(R,F,h){var a,J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O,n,K,Rg,U,vi,GI;
return g.u(function(gL){a=[];J=new Set;if(h.length)for(M=g.N(h),v=M.next();!v.done;v=M.next())if(I=v.value,w=void 0,(w=I.downloads)==null?0:w.length)for(E=g.N(I.downloads),B=E.next();!B.done;B=E.next())r=B.value,r.videoItem&&(Y=g.lp(r.videoItem).entityId,J.add(Y));if(R.videos){p=g.N(R.videos);for(k=p.next();!k.done;k=p.next())H=k.value,T=JSON.parse(g.lp(H).entityId),T.videoId&&!J.has(T.videoId)&&a.push(T.videoId);Z=g.N(F);for(b=Z.next();!b.done;b=Z.next())if(O=b.value,O.key!==R.key&&(n=O.videos))for(K=
g.N(n),Rg=K.next();!Rg.done;Rg=K.next())U=Rg.value,vi=JSON.parse(g.lp(U).entityId),vi.videoId&&(GI=a.indexOf(vi.videoId),GI!==-1&&a.splice(GI,1))}return gL.return(a)})},Gnv=function(R,F){var h,a,J,M,v,I,w,E;
return g.u(function(B){h=sh(R.avatar);a=g.N(F);for(J=a.next();!J.done;J=a.next())if(M=J.value,M.id!==R.id)for(v=g.N(sh(M.avatar)),I=v.next();!I.done;I=v.next())w=I.value,E=h.indexOf(w),E!==-1&&h.splice(E,1);return B.return(h)})},r17=function(R){var F;
return g.u(function(h){F=g.t(R.frameworkUpdates,NB);return R.frameworkUpdates&&F?g.m(h,$Wt(F),0):h.return()})},sj4=function(R){var F;
if((F=R.onResponseReceivedActions)!=null&&F.length){var h;R=(h=g.t(g.t(R.onResponseReceivedActions[0],YJe),g.NU6))==null?void 0:h.actions;if(R!=null&&R.length)return R}},pYh=function(R){var F,h,a;
return g.u(function(J){if(J.D==1)return R?g.m(J,Cy(R,g.d8,"mainDownloadsListEntity"),2):J.return([]);F=J.B;return((h=F)==null?0:(a=h.downloads)==null?0:a.length)?J.return(F.downloads.map(function(M){var v;return(v=M.videoItem)!=null?v:""})):J.return([])})},Qjh=function(R,F){var h;
return g.u(function(a){return a.D==1?g.m(a,kn7(R,F),2):(h=a.B)?g.m(a,VR(R,{mode:"readwrite",qt:!0},function(J){var M=[Ky(J,h.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];h.mainDownloadsListEntity&&M.push(Ky(J,h.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.Qe.all(M)}),0):a.G$(0)})},kn7=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O;
return g.u(function(n){if(n.D==1)return h=g.DI("main_downloads_library_id","mainDownloadsLibraryEntity"),a=g.DI("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.m(n,VR(R,{mode:"readonly",qt:!0},function(K){return g.Qe.all([dN(K,h,"mainDownloadsLibraryEntity"),dN(K,a,"mainDownloadsListEntity")])}),2);
J=n.B;M=g.N(J);v=M.next().value;I=M.next().value;w=v;E=I;w||(w={id:h});B=g.N(F);for(r=B.next();!r.done;r=B.next())if(Y=r.value,Y===g.d8){if(w.smartDownloadsList)return n.return();w.smartDownloadsList=Y}else if(p=g.lp(Y).entityType,k={},p==="mainPlaylistEntity"?k.playlistItem=Y:p==="mainVideoEntity"&&(k.videoItem=Y),!g.BV(k)){H=void 0;if((H=E)==null?0:H.downloads){T=!1;Z=g.N(E.downloads);for(b=Z.next();!b.done;b=Z.next())if(O=b.value,O.playlistItem===Y||O.videoItem===Y){T=!0;break}T||E.downloads.push(k)}else E=
{id:a,downloads:[k]};w.downloadsList=a}return n.return({mainDownloadsLibraryEntity:w,mainDownloadsListEntity:E})})},$K7=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p,k,H,T;
return g.u(function(Z){if(Z.D==1)return h=g.DI("main_downloads_library_id","mainDownloadsLibraryEntity"),a=g.DI("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.m(Z,VR(R,{mode:"readonly",qt:!0},function(b){return g.Qe.all([dN(b,h,"mainDownloadsLibraryEntity"),dN(b,a,"mainDownloadsListEntity"),dN(b,g.d8,"mainDownloadsListEntity")])}),2);
J=Z.B;M=g.N(J);v=M.next().value;I=M.next().value;w=M.next().value;E=v;B=I;r=w;if(!E)return Z.G$(0);if(F===g.d8&&((Y=r)==null?0:Y.downloads))r.downloads=[];else if((p=B)==null?0:p.downloads)for(k=g.lp(F).entityType,H=0;H<B.downloads.length;H++)if(T=B.downloads[H],k==="mainVideoEntity"&&T.videoItem===F){B.downloads.splice(H,1);break}else if(k==="mainPlaylistEntity"&&T.playlistItem===F){B.downloads.splice(H,1);break}return g.m(Z,VR(R,{mode:"readwrite",qt:!0},function(b){var O=[Ky(b,E,"mainDownloadsLibraryEntity")];
B&&O.push(Ky(b,B,"mainDownloadsListEntity"));r&&O.push(Ky(b,r,"mainDownloadsListEntity"));return g.Qe.all(O)}),0)})},H0=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y;
return g.u(function(p){if(p.D==1)return h=g.DI(F,"transfer"),a=g.DI(F,"videoDownloadContextEntity"),g.m(p,VR(R,{mode:"readonly",qt:!0},function(k){return g.Qe.all([dN(k,h,"transfer"),dN(k,a,"videoDownloadContextEntity")])}),2);
J=p.B;M=g.N(J);v=M.next().value;I=M.next().value;w=v;E=I;Y={videoId:F,cotn:(B=w)==null?void 0:B.cotn,offlineModeType:(r=E)==null?void 0:r.offlineModeType};return p.return(Y)})},LN=function(R,F,h,a,J){var M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O,n,K,Rg,U,vi;
return g.u(function(GI){switch(GI.D){case 1:return M=g.DI(R,"musicTrack"),v=g.DI(R,"transfer"),g.m(GI,VR(F,{mode:"readonly",qt:!0},function(gL){return g.Qe.all([dN(gL,M,"musicTrack"),dN(gL,v,"transfer"),Po(gL,"musicTrack"),Po(gL,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:I=GI.B;w=g.N(I);E=w.next().value;B=w.next().value;r=w.next().value;Y=w.next().value;p=E;k=B;H=r;T=Y;if(!p){GI.G$(3);break}return g.m(GI,A1t(p,H),4);case 4:return Z=GI.B,g.m(GI,$D(Z),3);case 3:b=[];O=g.N(T);for(n=O.next();!n.done;n=O.next())K=n.value,Rg=g.lp(K.key).entityId,U=kD(K),vi=g.lp(U.action.entityKey).entityId,Rg!==R&&vi!==R||rx(h,K.actionProto)||b.push(K.key);return g.m(GI,VR(F,{mode:"readwrite",qt:!0},function(gL){var Em=b.map(function(hf){return t8(gL,hf)});
Em.push(t8(gL,M,{QM:!0}));return g.Qe.all(Em)}),6);
case 6:YD(k),J&&gx(J),MB(a,{entityKey:M,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Na(GI)}})},TO=function(R,F,h,a,J){var M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O,n,K,Rg,U,vi,GI,gL,Em,hf,qa,m2,Ru,ng,$7,eB,ch,Y7,Kg,hX,f,Xl;
return g.u(function(b9){switch(b9.D){case 1:return M=g.DI(R,F),v=g.DI("music_downloads_library_id","musicDownloadsLibraryEntity"),g.m(b9,VR(h,{mode:"readonly",qt:!0},function(ag){return g.Qe.all([dN(ag,M,F),dN(ag,v,"musicDownloadsLibraryEntity"),Po(ag,F),Po(ag,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:I=b9.B;w=g.N(I);E=w.next().value;B=w.next().value;r=w.next().value;Y=w.next().value;p=E;k=B;H=r;T=Y;if(!p){b9.G$(3);break}return g.m(b9,A1t(p,H),4);case 4:return Z=b9.B,g.m(b9,$D(Z),3);case 3:b=[];O=new Map;if(!p){b9.G$(6);break}return g.m(b9,xKt(p,H,k),7);case 7:b=b9.B;n=g.N(b);for(K=n.next();!K.done;K=n.next())Rg=K.value,U=g.lp(Rg).entityId,O.set(U,{videoId:U,playlistId:R,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.m(b9,co(h,"transfer"),8);case 8:for(vi=b9.B,
GI=g.N(vi),gL=GI.next();!gL.done;gL=GI.next())Em=gL.value,hf=g.lp(Em.key).entityId,(qa=O.get(hf))&&Em&&(qa.cotn=Em.cotn);case 6:m2=[];Ru=g.N(T);for(ng=Ru.next();!ng.done;ng=Ru.next())$7=ng.value,eB=g.lp($7.key).entityId,ch=kD($7),eB!==R&&ch.rootActionId!==R||rx(a,$7.actionProto)||m2.push($7.key);Y7=g.DI(R,F);return g.m(b9,VR(h,{mode:"readwrite",qt:!0},function(ag){var fg=m2.map(function(L){return t8(ag,L)});
fg.push(t8(ag,Y7,{QM:!0}));return g.Qe.all(fg)}),9);
case 9:if(!p){b9.G$(0);break}b.reverse();if(!b.length){b9.G$(0);break}Kg=g.N(b);hX=Kg.next();case 12:if(hX.done){b9.G$(0);break}f=hX.value;Xl=g.lp(f).entityId;if(!Xl){b9.G$(13);break}return g.m(b9,LN(Xl,h,a,J,O.get(Xl)),13);case 13:hX=Kg.next(),b9.G$(12)}})},yy=function(R,F,h){var a,J,M,v,I,w,E;
return g.u(function(B){if(B.D==1)return g.m(B,VR(R,{mode:"readwrite",qt:!0},function(r){var Y=Po(r,"transfer"),p=Po(r,"offlineOrchestrationActionWrapperEntity");return g.Qe.all([Y,p]).then(function(k){k=g.N(k);var H=k.next().value;var T=k.next().value;k=Nz7.map(function(n){return ga7(r,n)});
T=g.N(T);for(var Z=T.next();!Z.done;Z=T.next()){Z=Z.value;var b=g.lp(Z.actionProto.entityKey).entityType==="musicTrack",O=Z.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";rx(F,Z.actionProto)||b&&(!b||O)||k.push(t8(r,Z.key,{QM:!0}))}return g.Qe.all(k).then(function(){return H})})}),2);
a=B.B;J=g.N(a);for(M=J.next();!M.done;M=J.next())v=M.value,YD(v),I=g.lp(v.key).entityId,w={videoId:I,offlineDeleteReason:void 0,cotn:v.cotn},gx(w),E=g.DI(I,"musicTrack"),MB(h,{entityKey:E,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.m(B,gyt(),0)})},HV9=function(R){for(var F,h=g.N(R.additionalMetadatas),a=h.next();!a.done;a=h.next())a=a.value,a.offlineMusicVideoData&&(F=a.offlineMusicVideoData);
var J,M,v,I,w;return{id:g.DI(R.videoId,"musicTrack"),videoId:R.videoId,title:R.title,thumbnailDetails:R.thumbnail,lengthMs:String(Number(R.lengthSeconds)*1E3),albumTitle:(J=F)==null?void 0:J.releaseTitle,musicVideoType:(M=F)==null?void 0:M.musicVideoType,contentRating:{explicitType:(v=F)==null?void 0:v.explicitType},artistNames:((I=F)==null?void 0:I.byline)||((w=F)==null?void 0:w.channelName),downloadMetadata:g.DI(R.videoId,"musicTrackDownloadMetadataEntity")}},xKt=function(R,F,h){var a,J,M,v,I,w,
E,B,r,Y,p,k,H,T,Z,b,O,n;
return g.u(function(K){a=[];J=new Set;if((M=h)==null?0:(v=M.downloadedTracks)==null?0:v.length)for(I=g.N(h.downloadedTracks),w=I.next();!w.done;w=I.next())E=w.value,J.add(E);if(R.tracks){B=g.N(R.tracks);for(r=B.next();!r.done;r=B.next())Y=r.value,J.has(Y)||a.push(Y);p=g.N(F);for(k=p.next();!k.done;k=p.next())if(H=k.value,H.id!==R.id&&(T=H.tracks))for(Z=g.N(T),b=Z.next();!b.done;b=Z.next())O=b.value,n=a.indexOf(O),n!==-1&&a.splice(n,1)}return K.return(a)})},A1t=function(R,F){var h,a,J,M,v,I,w,E;
return g.u(function(B){h=sh(R.thumbnailDetails);a=g.N(F);for(J=a.next();!J.done;J=a.next())if(M=J.value,M.id!==R.id)for(v=g.N(sh(M.thumbnailDetails)),I=v.next();!I.done;I=v.next())w=I.value,E=h.indexOf(w),E!==-1&&h.splice(E,1);return B.return(h)})},LW7=function(R,F){var h,a,J,M,v,I,w,E,B;
return g.u(function(r){if(r.D==1)return h=g.DI("music_downloads_library_id","musicDownloadsLibraryEntity"),g.m(r,Cy(R,h,"musicDownloadsLibraryEntity"),2);(a=r.B)||(a={id:h});J=g.lp(F).entityType;J==="musicTrack"?(M=a.downloadedTracks)!=null&&M.includes(F)||(a.downloadedTracks=((v=a.downloadedTracks)!=null?v:[]).concat(F)):J==="musicPlaylist"?(I=a.downloadedPlaylists)!=null&&I.includes(F)||(a.downloadedPlaylists=((w=a.downloadedPlaylists)!=null?w:[]).concat(F)):J!=="musicAlbumRelease"||(E=a.downloadedAlbumReleases)!=
null&&E.includes(F)||(a.downloadedAlbumReleases=((B=a.downloadedAlbumReleases)!=null?B:[]).concat(F));return g.m(r,U9(R,a,"musicDownloadsLibraryEntity"),0)})},Tz7=function(R,F){var h,a,J,M,v,I,w;
return g.u(function(E){if(E.D==1)return h=g.DI("music_downloads_library_id","musicDownloadsLibraryEntity"),g.m(E,Cy(R,h,"musicDownloadsLibraryEntity"),2);a=E.B;if(!a)return E.G$(0);J=g.lp(F).entityType;J==="musicTrack"?M=a.downloadedTracks:J==="musicPlaylist"&&(M=a.downloadedPlaylists);if((v=M)==null?0:v.length)for(I=0;I<M.length;I++)if(w=M[I],w===F){M.splice(I,1);break}return g.m(E,U9(R,a,"musicDownloadsLibraryEntity"),0)})},y1k=function(R){var F=R.videos;
R=[];var h=[];if(F){F=g.N(F);for(var a=F.next();!a.done;a=F.next()){var J=a.value.offlineVideoData.videoId;a=g.DI(J,"musicTrack");J=g.DI(J,"musicTrackDownloadMetadataEntity");R.push(a);h.push(J)}}return{Ep:R,Dm:h}},qB=function(R,F,h){F={track:HV9(F)};
h&&(F.playlistId=h);if(R=g.t(R.actionMetadata,qJ7))F.maximumDownloadQuality=R.maximumDownloadQuality;return{musicTrackEntityActionMetadata:F}},jj9=function(R){var F,h,a,J,M,v,I,w;
return g.u(function(E){switch(E.D){case 1:return F=g.zQ(),h=qLv(R),a=g.Ux(f_9),g.Hi(E,2),M={cR:!0},g.m(E,g.bN(F,h,a,void 0,M),4);case 4:J=E.B;g.yn(E,3);break;case 2:v=g.f_(E);if(v instanceof g.uN)throw I="GetOffline network manager error: "+v.message,an(I,v),Error(I);an("GetOffline fetch request error",v);throw Error("GetOffline fetch request error");case 3:w=fN(J);if(!J)throw an("Network request failed"),Error("Network request failed");if(w!==void 0)jK(w);else if(!J.videos||!J.videos.length)throw an("No data"),
Error("No data");return E.return(J.videos.map(function(B){return B.offlineVideoData}))}})},ZVG=function(R){var F,h,a,J,M,v,I,w;
return g.u(function(E){switch(E.D){case 1:return F=g.zQ(),h=fHe(R),a=g.Ux(f_9),g.Hi(E,2),M={cR:!0},g.m(E,g.bN(F,h,a,void 0,M),4);case 4:J=E.B;g.yn(E,3);break;case 2:v=g.f_(E);if(v instanceof g.uN)throw I="GetOffline network manager error for playlist: "+v.message,an(I,v),Error(I);an("GetOffline fetch request error for playlist",v);throw Error("GetOffline fetch request error for playlist");case 3:w=fN(J);if(!J)throw an("Network request failed for playlist"),Error("Network request failed for playlist");
if(w!==void 0)jK(w,"playlist");else if(!J.playlists||!J.playlists.length)throw an("No data for playlist"),Error("No data for playlist");return E.return(J.playlists.map(function(B){return B.offlinePlaylistData}))}})},SJh=function(R,F,h,a){var J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O,n,K,Rg,U,vi,GI,gL,Em,hf,qa,m2,Ru,ng,$7;
return g.u(function(eB){switch(eB.D){case 1:return g.m(eB,Wo(),2);case 2:J=eB.B;if(!J)return eB.return([]);M=[];if((v=a)==null?0:v.length){M=a;eB.G$(3);break}return g.m(eB,co(J,"mainPlaylistEntity"),4);case 4:M=eB.B;case 3:if(!M.length)return eB.return([]);I=[];w=Date.now()/1E3;E=g.N(M);B=E.next();case 5:if(B.done)return I.length?g.m(eB,bV4(I),10):eB.return([]);r=B.value;if(!r.downloadState){Y=void 0;eB.G$(8);break}return g.m(eB,Cy(J,r.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:Y=
eB.B;case 8:p=Y;k=void 0;T=(H=(k=r)==null?void 0:k.entityMetadata)&&H.nextAutoRefreshIntervalSeconds?Number(H.nextAutoRefreshIntervalSeconds):NaN;Z=Number.isNaN(T)?R:T;O=b=void 0;n=((b=p)==null?0:b.lastSyncedTimestampMillis)?Number((O=p)==null?void 0:O.lastSyncedTimestampMillis)/1E3:0;Rg=K=void 0;U=((K=p)==null?0:K.addedTimestampMillis)?Number((Rg=p)==null?void 0:Rg.addedTimestampMillis)/1E3:0;if(h||!H||n+Z<=w){vi=[];GI=void 0;if((GI=r.videos)==null?0:GI.length)for(gL=g.N(r.videos),Em=gL.next();!Em.done;Em=
gL.next())hf=Em.value,qa=JSON.parse(g.lp(hf).entityId),qa.videoId&&vi.push(qa.videoId);m2="0";H&&(Ru=void 0,m2=String(Number((Ru=H.offlineLastModifiedTimestampSeconds)!=null?Ru:0).toFixed()));ng={playlistId:r.playlistId,videoIds:vi,offlineLastModifiedTimestamp:m2,autoSync:F,offlineDateAddedTimestamp:String(U.toFixed())};I.push(ng)}B=E.next();eB.G$(5);break;case 10:return $7=eB.B,eB.return($7)}})},OV9=function(){var R,F,h,a,J;
return g.u(function(M){if(M.D==1)return g.m(M,Wo(),2);if(M.D!=3)return(R=M.B)?g.m(M,co(R,"refresh"),3):M.return(!1);F=M.B;if((h=F[0])==null||!h.refreshTime)return M.return(!1);a=Number(F[0].refreshTime);J=Date.now()/1E3;return M.return(isFinite(a)&&J>=a)})},oyk=function(R,F){var h,a,J;
return g.u(function(M){switch(M.D){case 1:return g.Hi(M,2),g.m(M,mKU(R,F),4);case 4:return a=M.B,g.m(M,r17(a),5);case 5:h=sj4(a);g.yn(M,3);break;case 2:J=g.f_(M),an("getAndProcessSmartDownloadsResponse request or processing error",J);case 3:return M.return(h)}})},XYk=function(R,F,h,a){var J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O,n,K,Rg,U,vi,GI,gL,Em,hf,qa,m2,Ru,ng,$7;
return g.u(function(eB){switch(eB.D){case 1:return g.m(eB,Wo(),2);case 2:J=eB.B;if(!J)return eB.return([]);M=[];if((v=a)==null?0:v.length){M=a;eB.G$(3);break}return g.m(eB,co(J,"musicPlaylist"),4);case 4:M=eB.B;case 3:if(!M.length)return eB.return([]);I=[];w=Date.now()/1E3;E=g.N(M);B=E.next();case 5:if(B.done)return I.length?g.m(eB,bV4(I),10):eB.return([]);r=B.value;Y=void 0;k=(p=(Y=r)==null?void 0:Y.entityMetadata)&&p.nextAutoRefreshIntervalSeconds?Number(p.nextAutoRefreshIntervalSeconds):NaN;H=
Number.isNaN(k)?R:k;Z=T=0;b="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!r.downloadMetadata){eB.G$(8);break}return g.m(eB,Cy(J,r.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:O=eB.B,K=n=void 0,T=Number((K=(n=O)==null?void 0:n.addedTimestampMillis)!=null?K:"0")/1E3,U=Rg=void 0,Z=Number((U=(Rg=O)==null?void 0:Rg.lastModifiedTimestampMillis)!=null?U:"0")/1E3,GI=vi=void 0,b=(GI=(vi=O)==null?void 0:vi.syncState)!=null?GI:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:gL=void 0;if(h||b!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!p||Number((gL=p.lastSyncedTimestampSeconds)!=null?gL:0)+H<=w){Em=[];hf=void 0;if((hf=r.tracks)==null?0:hf.length)for(qa=g.N(r.tracks),m2=qa.next();!m2.done;m2=qa.next())Ru=m2.value,Em.push(g.lp(Ru).entityId);ng={playlistId:r.playlistId,videoIds:Em,offlineLastModifiedTimestamp:String(Z.toFixed()),autoSync:F,offlineDateAddedTimestamp:String(T.toFixed())};I.push(ng)}B=E.next();eB.G$(5);break;case 10:return $7=eB.B,eB.return($7)}})},mKU=function(R,F){var h,a,J,M,v,I,w,E,B,r;
return g.u(function(Y){switch(Y.D){case 1:return h=g.zQ(),g.m(Y,Wo(),2);case 2:a=Y.B;if(!a){Y.G$(3);break}return g.m(Y,oag(a),4);case 4:J=Y.B;case 3:var p=J;M={context:g.l5(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:R},offlineClientState:p,clientStateRequestData:{preferredFormatType:F}}}};v=g.Ux(evg);g.Hi(Y,5);w={cR:!0};return g.m(Y,g.bN(h,M,v,void 0,w),7);case 7:I=Y.B;g.yn(Y,6);break;case 5:E=g.f_(Y);if(E instanceof g.uN)throw B=
"DPS network manager error for smart downloads: "+E.message,an(B,E),Error(B);an("DPS fetch request error for smart downloads",E);throw Error("DPS fetch request error for smart downloads");case 6:r=fN(I);if(I)r!==void 0&&jK(r,"smart downloads");else throw an("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return Y.return(I)}})},uy4=function(R,F){var h,a,J,M,v,I,w,E;
return g.u(function(B){switch(B.D){case 1:return h=g.zQ(),a={context:g.l5(),videoPlaybackPositionEntities:R,lastSyncTimestampUsec:F},J=g.Ux(nyv),g.Hi(B,2),v={cR:!0},g.m(B,g.bN(h,a,J,void 0,v),4);case 4:M=B.B;g.yn(B,3);break;case 2:I=g.f_(B);if(I instanceof g.uN)throw w="VPPS network manager error: "+I.message,an(w,I),Error(w);an("VPPS fetch request error",I);throw Error("VPPS fetch request error");case 3:E=fN(M);if(M)E!==void 0&&jK(E,"position sync");else throw an("Network request failed for position sync"),
Error("Network request failed for position sync");return B.return(M)}})},Pj6=function(R,F,h){var a,J,M,v,I,w,E,B;
return g.u(function(r){switch(r.D){case 1:a=g.zQ();var Y=h.refreshData,p=h.isEnqueuedForExpiredStreamUrlRefetch,k=h.Zm,H=h.offlineSourceData,T=h.mediaCapabilities,Z={entityKey:R};Y&&(Z.refreshData=Y);p&&(Z.isExpiredStreamUrlRefetch=p);k&&(Z.downloadParameters=k);H&&(Z.offlineSourceData=H);Y={context:g.Bn(F),signatureTimestamp:20264,videos:[Z]};T&&(Y.mediaCapabilities=T);J=Y;M=g.Ux(dKe);g.Hi(r,2);I={cR:!0};return g.m(r,g.bN(a,J,M,void 0,I),4);case 4:v=r.B;g.yn(r,3);break;case 2:w=g.f_(r);if(w instanceof
g.uN)throw E="GetPDE network manager error: "+w.message,an(E,w),Error(E);an("GetPDE fetch request error",w);throw Error("GetPDE fetch request error");case 3:B=fN(v);if(v)B!==void 0&&jK(B,"PDE");else throw an("Network request failed for PDE"),Error("Network request failed for PDE");return r.return(v)}})},fN=function(R){var F;
return(F=R.errorMetadata)==null?void 0:F.status},jK=function(R,F){F=F?" for "+F:"";
if(R===0)throw R="Empty response body"+F,an(R),Error(R);R="Response with error"+F;an(R);throw Error(R);},bV4=function(R){var F,h,a,J,M,v,I,w;
return g.u(function(E){switch(E.D){case 1:return F=g.zQ(),h=j2h(R),a=g.Ux(zv7),g.Hi(E,2),M={cR:!0},g.m(E,g.bN(F,h,a,void 0,M),4);case 4:J=E.B;g.yn(E,3);break;case 2:v=g.f_(E);if(v instanceof g.uN)throw I="offlinePlaylistSyncCheck network manager error: "+v.message,an(I,v),Error(I);an("offlinePlaylistSyncCheck fetch request error",v);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:w=fN(J);if(!J)throw an("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(w!==void 0)jK(w,"playlist sync");else if(!J.offlinePlaylistSyncCheckDatas||!J.offlinePlaylistSyncCheckDatas.length)throw an("No data for playlist sync"),Error("No data for playlist sync");return E.return(J.offlinePlaylistSyncCheckDatas.map(function(B){return B.offlinePlaylistSyncCheckData}))}})},Zc=function(R){this.B=R},KW6=function(R,F){var h,a,J,M,v,I;
return g.u(function(w){switch(w.D){case 1:h=new Map,a=g.N(F),J=a.next();case 2:if(J.done){w.G$(4);break}M=J.value;v=h;I=v.set;return g.m(w,R.D(M),5);case 5:I.call(v,M,w.B);J=a.next();w.G$(2);break;case 4:return w.return(h)}})},b$=function(R,F,h,a,J,M){F=g.DI(F,h);
a=Object.assign({},M,{priority:a,retryScheduleIntervalsInSeconds:J});return{actionType:R,entityKey:F,actionMetadata:a}},SK=function(R,F,h,a,J,M){this.status=R;
this.B=F;this.L=h;this.D=a;this.K=J;this.downloadState=M},tkt=function(R,F,h){this.B=R;
this.uu=F;this.K=h},Vkv=function(R,F){var h,a,J,M,v,I,w,E,B;
return g.u(function(r){switch(r.D){case 1:return h=F.entityKey,J=(a=g.t(F.actionMetadata,Oh))==null?void 0:a.isEnqueuedForExpiredStreamUrlRefetch,g.Hi(r,2),M=void 0,g.m(r,l_h(R,F),4);case 4:M=r.B;g.Hi(r,5);var Y=(Y=g.t(F.actionMetadata,Oh))?{maximumDownloadQuality:Y.maximumDownloadQuality}:void 0;return g.m(r,Pj6(h,R.uu,{isEnqueuedForExpiredStreamUrlRefetch:J,Zm:Y,offlineSourceData:M}),7);case 7:v=r.B;g.yn(r,6,2);break;case 5:return g.f_(r,2),I=In(F)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",an("PDE handleAdd error"),r.return(on(F,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",I,"DOWNLOAD_STATE_FAILED"));case 6:return g.m(r,DKL(R,v,F),8);case 8:return r.return(on(F,!0,v.orchestrationActions));case 2:return w=g.f_(r),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.EU&&w.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
B="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),an("PDE handleAdd error"),r.return(on(F,!1,void 0,E,B,"DOWNLOAD_STATE_FAILED"))}})},c1u=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O,n,K,Rg,U,vi,GI;
return g.u(function(gL){switch(gL.D){case 1:return h=F.entityKey,a=g.lp(h).entityId,g.m(gL,VR(R.B,{mode:"readonly",qt:!0},function(Em){var hf=dN(Em,h,"playbackData"),qa=dN(Em,g.DI(a,"offlineVideoPolicy"),"offlineVideoPolicy");Em=dN(Em,g.DI(a,"transfer"),"transfer");return g.Qe.all([hf,qa,Em])}),2);
case 2:J=gL.B;M=g.N(J);v=M.next().value;I=M.next().value;w=M.next().value;E=v;B=I;r=w;if(!E||!B)return gL.return(on(F,!0));Y=[];H=((k=E)==null?0:k.playerResponseJson)?JSON.parse(E.playerResponseJson):null;if(!(r&&H&&R.uu.X("html5_refresh_deprecated_downloads"))){gL.G$(3);break}p=UK9(R,H,r);return g.m(gL,Cj7(R,r),4);case 4:Y=gL.B;case 3:T={lastPlayerResponseTimestampSeconds:E.playerResponseTimestamp,offlineToken:B.offlineToken,formatIds:Y};Z={};if((b=r)==null?0:b.maximumDownloadQuality)Z.maximumDownloadQuality=
r.maximumDownloadQuality;g.Hi(gL,5);O=void 0;return g.m(gL,l_h(R,F),7);case 7:return O=gL.B,g.Hi(gL,8),g.m(gL,Pj6(h,R.uu,{refreshData:T,Zm:Z,offlineSourceData:O,mediaCapabilities:p}),10);case 10:n=gL.B;g.yn(gL,9,5);break;case 8:return g.f_(gL,5),K=In(F)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",an("PDE handleRefresh error"),gL.return(on(F,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",K,
"DOWNLOAD_STATE_FAILED"));case 9:return g.m(gL,DKL(R,n,F),11);case 11:return gL.return(on(F,!0,n.orchestrationActions));case 5:return Rg=g.f_(gL),U="PDE handleRefresh error",Rg instanceof Error&&(U="PDE handleRefresh error: "+Rg.message),vi="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",GI="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Rg instanceof g.EU&&Rg.type==="QUOTA_EXCEEDED"&&(vi="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",GI="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
an(U),gL.return(on(F,!1,void 0,vi,GI,"DOWNLOAD_STATE_FAILED"))}})},l_h=function(R,F){var h,a,J,M;
return g.u(function(v){if(v.D==1)return h=g.lp(F.entityKey).entityId,a=g.DI(h,"videoDownloadContextEntity"),g.m(v,Cy(R.B,a,"videoDownloadContextEntity"),2);J=v.B;return(M=J)!=null&&M.offlineModeType?v.return({offlineModeType:J.offlineModeType}):v.return(void 0)})},DKL=function(R,F,h){var a,J,M,v,I;
return g.u(function(w){if(w.D==1){if(!F.frameworkUpdates||!g.t(F.frameworkUpdates,NB))return w.return();if(!(g.t(F.frameworkUpdates,NB).mutations&&g.t(F.frameworkUpdates,NB).mutations.length>0&&g.t(F.frameworkUpdates,NB).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return w.G$(2);a=g.lp(g.t(F.frameworkUpdates,NB).mutations[0].entityKey).entityId;return g.m(w,H0(R.B,a),3)}if(w.D!=2){J=w.B;M=g.t(h.actionMetadata,Oh);if(I=(v=M)==null?void 0:v.playlistId)J.playlistId=I;J.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.ig(R.uu)?g.m(w,xD(a,R.B,h,R.K,J),2):g.b5(R.uu)?g.m(w,LN(a,R.B,h,R.K),2):w.G$(2)}return g.m(w,$Wt(g.t(F.frameworkUpdates,NB)),0)})},on=function(R,F,h,a,J,M){return new SK(F?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",In(R),h,a,J,M)},UK9=function(R,F,h){F=MkU(R.uu,h.cotn,F);
h=g.xF(F);return g.cd7(F,h,R.uu)},Cj7=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y;
return g.u(function(p){if(p.D==1)return h=[],g.m(p,VR(R.B,{mode:"readonly",qt:!0},function(k){var H=[],T=F.offlineVideoStreams;if(T){T=g.N(T);for(var Z=T.next();!Z.done;Z=T.next())H.push(dN(k,Z.value,"offlineVideoStreams"))}return g.Qe.all(H)}),2);
if(a=p.B)for(J=g.N(a),M=J.next();!M.done;M=J.next())if(v=M.value,I=void 0,(I=v)==null?0:I.streamsProgress)for(w=v.streamsProgress,E=0;E<w.length;E++)B=w[E],r=JSON.parse(B.formatStreamBytes),Y={itag:r.itag,lmt:r.lastModified,xtags:r.xtags},h.push(Y);return p.return(h)})},WW7=function(R,F){this.B=R;
this.uu=F},RG6=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p;
return g.u(function(k){switch(k.D){case 1:return h=In(F),g.m(k,co(R.B,"videoPlaybackPositionEntity"),2);case 2:a=k.B;if(a.length===0)return k.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));g.Hi(k,3);return g.m(k,es.getInstance(),5);case 5:J=k.B;if(!J)throw Error("prefStorage is undefined");return g.m(k,J.get("psi"),6);case 6:return M=k.B,w=(I=(v=M)==null?void 0:v.zY)!=null?I:"0",g.m(k,uy4(a,w),7);case 7:return E=k.B,B={isPaused:E.watchHistoryPaused,zY:E.syncTimestampUsec},g.m(k,J.set("psi",
B),8);case 8:if(B.isPaused){k.G$(9);break}r=g.t(E.frameworkUpdates,NB);if(!E.frameworkUpdates||!r){k.G$(9);break}return g.m(k,$Wt(r),9);case 9:g.yn(k,4);break;case 3:return Y=g.f_(k),p="PPE handleRefresh error: "+(Y instanceof Error?Y.message:"unknown error"),an(p),k.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return k.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},hGv=function(R,F){var h,a,J,M,v,I,w,E;
return g.u(function(B){switch(B.D){case 1:return h=In(F),a=g.lp(F.entityKey).entityId,g.Hi(B,2),g.m(B,es.getInstance(),4);case 4:J=B.B;if(!J)throw Error("prefStorage is undefined");return g.m(B,J.get("psi"),5);case 5:M=B.B;v=g.t(F.actionMetadata,Fdh);if(((I=M)==null?void 0:I.isPaused)!==!1||(w=v)==null||!w.lastPlaybackPositionSeconds){B.G$(6);break}E={key:g.DI(a,"videoPlaybackPositionEntity"),videoId:a,lastPlaybackPositionSeconds:v.lastPlaybackPositionSeconds};return g.m(B,U9(R.B,E,"videoPlaybackPositionEntity"),
6);case 6:g.yn(B,3);break;case 2:return g.f_(B),B.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return B.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h))}})},aY9=function(R,F){var h,a,J;
return g.u(function(M){switch(M.D){case 1:h=In(F);g.Hi(M,2);a=g.lp(F.entityKey).entityId;if(a==="!*$_ALL_ENTITIES_!*$")return g.m(M,YLL(R.B),5);J=g.DI(a,"videoPlaybackPositionEntity");return g.m(M,rhU(R.B,J),5);case 5:g.yn(M,3);break;case 2:return g.f_(M),M.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return M.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},Jj7=function(R,F){this.api=R;
this.B=F;this.logger=new g.s3("woffle");this.D=!1;this.rf={kh:this.kh};this.logger.debug("Initialized OfflineMediaManager")},Mr4=function(R){return g.u(function(F){return F.return(yhG(R))})},vYL=function(R){var F;
return g.u(function(h){if(h.D==1)return g.m(h,g.Tkm(R),2);F=h.B;return h.return(F.filter(function(a){return!!a.url}).map(function(a){return a.url}))})},Xb=function(R,F){var h=g.KZ(F);
if(h===1||h===0)return Promise.resolve();(h=gYh(R,F))&&h.stopVideo();R.K=0;return Mr4(F)},eK=function(R,F,h,a){h=h===void 0?!1:h;
a=a===void 0?!0:a;var J=typeof F==="string"?F:F.videoDetails.videoId;g.KZ(J)===2&&((F=gYh(R,J))?F.stopVideo():R.logger.info(function(){return"Corresponding player for "+J+" not found. Pausing anyway"}),g.tJ(J,2),R.K=2,h?G$L(R.B):a&&IYG(R.B))},gYh=function(R,F){var h;
return((h=R.player)==null?void 0:h.getVideoData().videoId)===F?R.player:null},iD4=function(R,F,h){F.getPlayerResponse();
g.tJ(F.videoId,2);R.K=2;R.D=!1;var a;(a=R.player)==null||a.dispose();R.player=R.api.r7(F);F={};R.player.Fc((F.localmediachange=R.Iv,F.signatureexpired=R.xB,F.statechange=R.QRb,F),R);var J=R.kh(h);R.player.I7(g.NR(J,J,!0,"m"),!1);R.logger.debug(function(){return"Starting headless playback with quality: "+J});
R.player.ke(!1)},w9L=function(R,F){this.B=R;
this.uu=F},BIL=function(R,F){var h,a;
return g.u(function(J){switch(J.D){case 1:return h=In(F),g.m(J,Cy(R.B,F.entityKey,"transfer"),2);case 2:if(a=J.B)return J.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));g.Hi(J,3);return g.m(J,EYt(R,F),5);case 5:g.yn(J,4);break;case 3:return g.f_(J),J.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return J.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},rjL=function(R,F){var h,a;
return g.u(function(J){switch(J.D){case 1:return h=In(F),g.m(J,Cy(R.B,F.entityKey,"transfer"),2);case 2:a=J.B;if(!a||a.transferState!=="TRANSFER_STATE_COMPLETE")return J.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));g.Hi(J,3);return g.m(J,EYt(R,F,!0),5);case 5:g.yn(J,4);break;case 3:return g.f_(J),J.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return J.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h))}})},YXU=function(R,F){var h,a,J,M,v,I,w,E,B,r;
return g.u(function(Y){switch(Y.D){case 1:return h=In(F),a=g.lp(F.entityKey).entityId,g.m(Y,VR(R.B,{mode:"readonly",qt:!0},function(p){var k=dN(p,F.entityKey,"transfer");p=dN(p,g.DI(a,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Qe.all([k,p])}),2);
case 2:J=Y.B;M=g.N(J);v=M.next().value;I=M.next().value;w=v;E=I;if(!w||w.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return Y.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));g.Hi(Y,3);w.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.m(Y,U9(R.B,w,"transfer"),5);case 5:B=g.lp(w.key).entityId;W76({videoId:B,jy:w,offlineModeType:(r=E)==null?void 0:r.offlineModeType});g.yn(Y,4);break;case 3:return g.f_(Y),Y.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return Y.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h))}})},EYt=function(R,F,h){h=h===void 0?!1:h;
var a,J,M,v,I,w,E,B,r,Y,p,k,H,T,Z;return g.u(function(b){switch(b.D){case 1:return a=g.t(F.actionMetadata,s3g),J=g.lp(F.entityKey).entityId,M=g.DI(J,"downloadStatusEntity"),g.m(b,VR(R.B,{mode:"readonly",qt:!0},function(O){var n=dN(O,M,"downloadStatusEntity");O=dN(O,g.DI(J,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Qe.all([n,O])}),2);
case 2:return v=b.B,I=g.N(v),w=I.next().value,E=I.next().value,B=w,r=E,Y="TRANSFER_STATE_TRANSFER_IN_QUEUE",((p=B)==null?void 0:p.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(Y="TRANSFER_STATE_PAUSED_BY_USER"),T={key:F.entityKey,transferState:Y,cotn:g.sY(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(k=a)==null?void 0:k.maximumDownloadQuality,preferredAudioTrack:(H=a)==null?void 0:H.preferredAudioTrack,transferRetryCount:0,isRefresh:h,hasLoggedFirstStarted:!1},g.m(b,VR(R.B,
{mode:"readwrite",qt:!0},function(O){var n=[];h&&n.push(t8(O,g.DI(J,"offlineVideoStreams")));n.push(Ky(O,T,"transfer"));return g.Qe.all(n)}),3);
case 3:if(!h){b.G$(4);break}return g.m(b,Mr4(J),4);case 4:Ce6({videoId:J,jy:T,offlineModeType:(Z=r)==null?void 0:Z.offlineModeType}),g.Na(b)}})},k$e=function(R,F,h,a){if(!R.action.entityKey)throw Error("entityKey is missing.");
var J=g.lp(R.action.entityKey);J={entityType:J.Cl,entityId:J.entityId,offlineOrchestrationActionType:R.action.actionType,orchestrationAction:{orchestrationActionId:R.actionId}};F&&(J.offlineOrchestrationActionResult=F.status,J.isRetryable=h?!1:F.B,F.K&&(J.offlineOrchestrationFailureReason=p99(F.K,J.isRetryable)));var M,v;if((M=R.action.actionMetadata)==null?0:(v=M.offlineLoggingData)==null?0:v.offlineModeType)J.offlineModeType=R.action.actionMetadata.offlineLoggingData.offlineModeType;a&&(J.additionalOrchestrationActions=
a.map(function(I){return{orchestrationActionId:I.actionId}}));
return J},p99=function(R,F){return R!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||F?R==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&F?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":R:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},Q3t=function(R,F){var h={offlineOrchestrationContext:k$e(R)};
F=OJ7(F,h);mWL(SLL(),F,R.rootActionId)},$ne=function(R,F,h,a){a=a===void 0?[]:a;
F={offlineOrchestrationContext:k$e(R,F,h,a)};F=OJ7(3,F);mWL(SLL(),F,R.rootActionId)},AjU=function(){this.actions=[]},xnL=function(R,F){F=g.N(F);
for(var h=F.next();!h.done;h=F.next())h=h.value,Q3t(h,1),R.actions.push(h);R.actions.sort(R.B)},NIL=function(R,F){if(F)for(var h=0;h<R.actions.length;h++)if(F==="!*$_ALL_ENTITIES_!*$"&&R.actions[h].actionId!==F||F!=="!*$_ALL_ENTITIES_!*$"&&R.actions[h].rootActionId===F&&R.actions[h].actionId!==F)R.actions.splice(h,1),h--},HDk=function(R,F){R=g.N(R.actions);
for(var h=R.next();!h.done;h=R.next())if(h.value.actionId===F)return!0;return!1},nN=function(R,F,h,a,J){g.d.call(this);
var M=this;this.D=R;this.KI=F;this.oR=h;this.Y=a;this.uu=J;this.B=new AjU;this.S=new g.un;this.K=new g.DY(function(){M.retry()});
this.Z=NaN;this.N=!1;this.rf={mhz:function(){return M.B},
Ky:function(){return M.S},
Atb:function(){return M.K},
retry:function(){return M.retry()}};
g.z(this,this.K);this.C=this.D.observe(this.aR.bind(this))},yjL=function(R,F,h,a,J){var M;
return g.u(function(v){if(v.D==1)return M=new nN(R,F,h,a,J),g.m(v,Ld9(M),2);TIk(M);return v.return(M)})},TIk=function(R){var F=R.B.actions[0];
return R.L?((F==null?void 0:F.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&R.L[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(R.N=!0),Promise.resolve()):qX4(R)},qX4=function(R){var F,h,a,J,M,v,I,w,E,B,r,Y,p,k,H,T,Z;
return g.u(function(b){switch(b.D){case 1:if(R.L)throw Error("Already processing an action");if(R.RR())return b.return();F=R.B.actions.shift();VVk(R.oR,!F);if(F===void 0)return b.return();F.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&F.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&NIL(R.B,F.actionId);h="";F.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&F.rootActionId===F.actionId&&(h=F.actionId);a=[F];R.L=a;if(J=R.KI[F.entityType]){b.G$(2);break}R.L=
void 0;return g.m(b,qX4(R),3);case 3:return b.return();case 2:M=g.N(a);for(v=M.next();!v.done;v=M.next())I=v.value,Q3t(I,2);g.Hi(b,4,5);return g.m(b,KW6(J,a.map(function(O){return O.action})),7);
case 7:w=b.B,E=g.N(a),B=E.next();case 8:if(B.done){b.G$(10);break}r=B.value;Y=w.get(r.action);return g.m(b,fYk(R,r,Y),9);case 9:B=E.next();b.G$(8);break;case 10:NIL(R.B,h);case 5:g.SB(b);R.L=void 0;g.Om(b,6);break;case 4:return p=g.f_(b),an("Orchestration error",p),g.Hi(b,12),g.m(b,j37(R,a),14);case 14:g.yn(b,5);break;case 12:k=g.f_(b);an("Orchestration retry error",k);H=g.N(a);for(T=H.next();!T.done;T=H.next())Z=T.value,Z.retryScheduleIndex<3&&xnL(R.B,[Z]);b.G$(5);break;case 6:return g.m(b,qX4(R),
0)}})},fYk=function(R,F,h){var a,J,M,v,I,w,E,B,r,Y,p,k;
return g.u(function(H){switch(H.D){case 1:a=F.retryScheduleIndex+2===3;if(h.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){H.G$(2);break}if(h.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){H.G$(0);break}$ne(F,h,a);if(h.B&&F.retryScheduleIndex+1<3)return g.m(H,j37(R,[F]),0);M=((J=h)==null?0:J.D)?h.D:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";v={entityKey:F.action.entityKey,failureReason:M};I=void 0;g.ig(R.uu)?I="mainVideoDownloadStateEntity":g.b5(R.uu)&&(I="musicTrackDownloadMetadataEntity");
if(!I||!h.downloadState){H.G$(7);break}w=g.lp(F.action.entityKey).entityId;return g.m(H,B0(w,I,R.D,h.downloadState),7);case 7:MB(R.Y,v);if(h.downloadState==="DOWNLOAD_STATE_FAILED"&&R.uu.X("html5_auto_retry_failed_pde_actions")){H.G$(0);break}an("Orchestration result is not retryable, deleting action");return g.m(H,rhU(R.D,Qy(F).key),0);case 2:E=void 0;try{E=(B=h.L)==null?void 0:B.map(function(T){return R.createAction(T,F)})}catch(T){return $ne(F,h,a),r={entityKey:F.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},MB(R.Y,r),an("Orchestration subactions creation error",T),H.return()}$ne(F,h,a,E);if(!E){H.G$(12);break}Y=E.map(function(T){return Qy(T)});
p=0;case 13:if(!(p<E.length)||R.N){H.G$(15);break}return g.m(H,VR(R.D,{mode:"readwrite",qt:!0},function(T){var Z=[];Z.push(Jh7(T,Y.slice(p,p+10),"offlineOrchestrationActionWrapperEntity"));return g.Qe.all(Z)}),16);
case 16:p+=10;H.G$(13);break;case 15:if(R.N)return R.N=!1,H.return();case 12:return k=Qy(F),g.m(H,rhU(R.D,k.key),17);case 17:Q3t(F,4),g.Na(H)}})},OD9=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p;
return g.u(function(k){h=[];a=Infinity;J=4E3;M=g.N(F);for(v=M.next();!v.done;v=M.next())I=v.value,w=Number(I.enqueueTimeSec),E=ZDU(w),B=I.retryScheduleIndex,r=B!=null&&B>0,E>0&&r?(a=Math.min(a,w),J=Math.min(E,J)):h.push(I);isFinite(a)&&(!R.K.isActive()||a<R.Z)&&(R.Z=a,R.K.start(J));R.S.sT()||(Y=h.length,h=h.filter(function(H){var T;H=((T=H.actionProto)==null?void 0:T.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!bDu.includes(H)}),p=h.length<Y,!R.K.isActive()&&p&&R.K.start(1));
h.length>0&&SXv(R,h);return g.m(k,TIk(R),0)})},oYU=function(R){var F,h,a,J,M,v,I;
return g.u(function(w){if(w.D==1)return g.m(w,mnk(R),2);F=w.B;h=[];a=g.N(F);for(J=a.next();!J.done;J=a.next())M=J.value,v=g.lp(M.key),I=v.entityId,HDk(R.B,I)||h.push(M);return g.m(w,OD9(R,h),0)})},ZDU=function(R){R=R*1E3-Date.now();
return R>4E3?4E3:R},j37=function(R,F){var h,a,J;
return g.u(function(M){h=g.N(F);for(a=h.next();!a.done;a=h.next()){J=a.value;var v=void 0,I=void 0,w=((I=J.action)==null?void 0:(v=I.actionMetadata)==null?void 0:v.retryScheduleIntervalsInSeconds)||[1,2,4];v=1;J.retryScheduleIndex<w.length&&(v=w[J.retryScheduleIndex]);J.B=v*1E3+Date.now();J.retryScheduleIndex++}return g.m(M,X96(R,F),0)})},Ld9=function(R){var F;
return g.u(function(h){if(h.D==1)return g.m(h,co(R.D,"offlineOrchestrationActionWrapperEntity"),2);F=h.B;return g.m(h,OD9(R,F),0)})},SXv=function(R,F){F.length!==0&&F.forEach(function(h){h=kD(h);
h.retryScheduleIndex<3&&xnL(R.B,[h])})},mnk=function(R,F){var h;
return g.u(function(a){if(a.D==1)return g.m(a,co(R.D,"offlineOrchestrationActionWrapperEntity",F),2);h=a.B;return a.return(h.filter(AhL))})},X96=function(R,F){if(F.length===0)return Promise.resolve([]);
F=F.map(function(h){return Qy(h)});
return Bq7(R.D,F)},eG9=function(R){this.Xo=R;
this.B=void 0},nYu=function(R,F){var h,a,J,M;
return g.u(function(v){h=F.videoId;a=!0;if(F.captionTracks.length)J=cT7(F),R.B=new g.yw(R.Xo,F,J);else if(F.d$)M=g.o87(F),R.B=new g.fs(R.Xo,F.d$,h,M,F.eE,F.eventId),a=F.eE;else return v.return();return v.return(new Promise(function(I){var w;(w=R.B)==null||w.u6({P_:function(){return g.u(function(E){if(E.D==1)return g.m(E,R.P_(h,a),2);I();g.Na(E)})},
OR:function(){}})}))})},uO7=function(R){var F;
return g.u(function(h){if(h.D==1)return g.m(h,Tqh(R),2);F=h.B;return h.return(!!F&&F.length>0)})},u$=function(R){g.d.call(this);
this.B=R;this.D=this.B.observe(this.K.bind(this))},dn4=function(R,F){var h,a,J,M,v,I,w;
return g.u(function(E){switch(E.D){case 1:if(F.length===0)return E.return([]);h=F.map(function(B){return g.DI(B,"transfer")});
return g.m(E,co(R.B,"transfer",h),2);case 2:a=E.B;J=a.filter(AhL).map(function(B){return g.lp(B.key).entityId});
M=F.filter(function(B){return J.indexOf(B)===-1});
if(M.length===0)return E.return([]);v=g.N(M);I=v.next();case 3:if(I.done){E.G$(5);break}w=I.value;return g.m(E,Mr4(w),4);case 4:I=v.next();E.G$(3);break;case 5:return E.return(M)}})},Kd7=function(R,F,h,a,J,M){var v,I,w;
return g.u(function(E){v="STREAM_TYPE_UNKNOWN";h.video&&h.audio?(v="STREAM_TYPE_AUDIO_AND_VIDEO",an("unexpected stream type")):h.video&&!h.audio?v="STREAM_TYPE_VIDEO":!h.video&&h.audio&&(v="STREAM_TYPE_AUDIO");I=g.DI(F,"offlineVideoStreams");w={numBytesDownloaded:J.toFixed(),numTotalBytes:M.toFixed(),streamType:v,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(a),itag:v==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(h.itag):void 0};return g.m(E,VR(R,{mode:"readwrite",qt:!0},
function(B){var r=dN(B,I,"offlineVideoStreams"),Y=dN(B,g.DI(F,"transfer"),"transfer");return g.Qe.all([r,Y]).then(function(p){p=g.N(p);var k=p.next().value;p=p.next().value;if(!p)return t8(B,I).then(function(){});
var H=PG9(k);k=zGh(k,a,w,I);var T=Ky(B,k,"offlineVideoStreams");PG9(k)>H&&(p.lastProgressTimeMs=Date.now().toString());H=[T];p.offlineVideoStreams||(p.offlineVideoStreams=[]);p.offlineVideoStreams.indexOf(I)===-1&&(p.offlineVideoStreams.push(I),H.push(Ky(B,p,"transfer")));return g.Qe.all(H)})}),0)})},tru=function(R,F){var h,a,J,M,v;
return g.u(function(I){if(I.D==1)return h=g.DI(F,"offlineVideoStreams"),g.m(I,Cy(R,h,"offlineVideoStreams"),2);a=I.B;if(!a||!a.streamsProgress)return I.return();J=g.N(a.streamsProgress);for(M=J.next();!M.done;M=J.next())v=M.value,v.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",v.numTotalBytes!==v.numBytesDownloaded&&(v.numBytesDownloaded=v.numTotalBytes);return g.m(I,U9(R,a,"offlineVideoStreams"),0)})},zGh=function(R,F,h,a){if(R&&R.streamsProgress){a=R;
a:{F=F.itag+";"+F.xtags;for(var J=R.streamsProgress,M=0;M<J.length;M++){var v=JSON.parse(J[M].formatStreamBytes);if(v.itag+";"+v.xtags===F){J[M]=h;h=J;break a}}J.push(h);h=J}a.streamsProgress=h}else R={key:a,streamsProgress:[h]};return R},PG9=function(R){if(R==null?0:R.streamsProgress){var F=0;
R=R.streamsProgress;for(var h=0;h<R.length;h++){var a=R[h];isNaN(Number(a.numBytesDownloaded))?an("stream progress bytes number invalid"):F+=Number(a.numBytesDownloaded)}return F}return 0},lYk=function(R,F,h,a){g.d.call(this);
var J=this;this.D=R;this.api=F;this.PG=h;this.aR=a;this.S=new g.un;this.L=new g.DY(function(){J.B&&J.B.transferState==="TRANSFER_STATE_TRANSFERRING"&&J.S.sT()&&((J.B.transferRetryCount||0)<3?eK(J.Y,J.N,!1,!1):Xb(J.Y,J.N.videoDetails.videoId),J.q_("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.oR=this.fI=0;this.C=this.Z=!1;this.IR=g.RI(this.api.W().experiments,"html5_transfer_processing_logs_interval");this.NQ=new g.xK(this);this.rf={qt$:function(){return J.L},
BpI:function(){return J.aR},
Ky:function(){return J.S}};
this.KI=this.D.observe(this.fE.bind(this));this.Y=new Jj7(F,this);this.Fo=new eG9(F);this.Uz=new u$(this.D);this.Sl=this.S.listen("publicytnetworkstatus-online",this.qr.bind(this));this.Oz=this.S.listen("publicytnetworkstatus-offline",this.MIu.bind(this));this.C=this.api.W().X("html5_less_transfer_processing_logs");g.z(this,this.NQ);this.NQ.T(F,"offlinetransferpause",this.qfI);if(g.ig(this.api.W()))this.K="mainVideoDownloadStateEntity";else if(g.b5(this.api.W())||g.EZ(this.api.W()))this.K="musicTrackDownloadMetadataEntity"},
DnU=function(R){return g.u(function(F){if(F.D==1)F=g.m(F,HJh(),2);
else{var h=R.Uz;var a=g.zy();a=Object.keys(a);h=dn4(h,a);F=g.m(F,h,0)}return F})},P0=function(R,F){F=F===void 0?!1:F;
var h;return g.u(function(a){if(a.D==1){if(R.B)throw Error("Already downloading a video");R.oR=0;R.Z=!1;return g.m(a,Vr4(R),2)}return a.D!=4?(h=a.B,UWk(R.PG,!h),h&&R.S.sT()?F?g.m(a,new Promise(function(J){g.Eg(J,1E3)}),4):a.G$(4):(!h&&R.B&&dx(R),a.G$(0))):g.m(a,Unk(R,h),0)})},CGe=function(R){return g.u(function(F){if(F.D==1)return R.N?g.m(F,Xb(R.Y,R.N.videoDetails.videoId),3):F.G$(0);
dx(R);g.Na(F)})},cj9=function(R,F){var h,a,J;
return g.u(function(M){switch(M.D){case 1:return g.Hi(M,2),(h=!!F.captionTracks.length||!!F.d$)?g.m(M,uO7(F.videoId),4):M.return();case 4:return(a=M.B)?M.return():g.m(M,nYu(R.Fo,F),5);case 5:g.yn(M,0);break;case 2:J=g.f_(M),an("Caption downloading error",J,F.cotn),g.Na(M)}})},Unk=function(R,F){var h,a,J,M,v,I;
return g.u(function(w){switch(w.D){case 1:if(R.Z)return w.return();R.Z=!0;R.B=F;h=g.lp(R.B.key);a=h.entityId;J=void 0;if(R.B.transferState==="TRANSFER_STATE_TRANSFERRING")return g.m(w,zO(R,a),7);if(R.B.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||R.B.transferRetryCount||R.B.hasLoggedFirstStarted){w.G$(3);break}return g.m(w,zO(R,a),5);case 5:return J=w.B,R.B.hasLoggedFirstStarted=!0,g.m(w,WdG(R),6);case 6:chG({videoId:a,jy:R.B,offlineModeType:J},void 0,void 0,!0);w.G$(3);break;case 7:J=w.B,
GO({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:a,jy:R.B,offlineModeType:J});case 3:return g.m(w,R76(R),8);case 8:return M=null,g.Hi(w,9),g.m(w,Fnh(R,F),11);case 11:M=w.B;R.N=M;g.yn(w,10);break;case 9:return v=g.f_(w),an("error getting player response",v,F.cotn),g.m(w,R.q_("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return w.return();case 10:return I=MkU(R.api.W(),F.cotn,M),g.m(w,cj9(R,I),13);case 13:return g.m(w,vYL(I.videoId),
14);case 14:I.JF=w.B,iD4(R.Y,I,F.maximumDownloadQuality),R.L.start(108E5),g.Na(w)}})},Vr4=function(R){var F,h;
return g.u(function(a){if(a.D==1)return g.m(a,co(R.D,"transfer"),2);F=a.B;h=F.filter(h77).sort(al9);return h.length===0?a.return():a.return(h[0])})},R76=function(R){var F,h,a;
return g.u(function(J){if(J.D==1){if(!R.B)return KN(R,"onTransferStart"),J.return();R.L.start(108E5);return g.m(J,tK(R,"TRANSFER_STATE_TRANSFERRING"),2)}F=R.B;return(a=((h=F)==null?0:h.key)?g.lp(F.key).entityId:"")&&R.K?g.m(J,B0(a,R.K,R.D,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):J.G$(0)})},G$L=function(R){var F,h,a,J;
g.u(function(M){switch(M.D){case 1:if(!R.B){KN(R,"onTransferPausedByUser");M.G$(2);break}F=R.B;R.L.stop();return g.m(M,tK(R,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:a=((h=F)==null?0:h.key)?g.lp(F.key).entityId:"";if(!a||!R.K){M.G$(4);break}return g.m(M,B0(a,R.K,R.D,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.m(M,zO(R,a),6);case 6:J=M.B,Rvh({videoId:a,jy:F,offlineModeType:J});case 2:dx(R),P0(R),g.Na(M)}})},IYG=function(R){var F,h,a;
g.u(function(J){if(J.D==1){if(!R.B)return KN(R,"onTransferPausedByNetwork"),J.return();R.L.stop();return g.m(J,tK(R,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(J.D!=3)return F=R.B,(a=((h=F)==null?0:h.key)?g.lp(F.key).entityId:"")&&R.K?g.m(J,B0(a,R.K,R.D,"DOWNLOAD_STATE_PAUSED"),3):J.G$(3);dx(R);g.Na(J)})},J$6=function(R){var F,h,a,J,M;
g.u(function(v){switch(v.D){case 1:if(!R.B)return KN(R,"onTransferComplete"),v.return();F=R.B;R.L.stop();if(!F||!R.N){v.G$(2);break}h=MkU(R.api.W(),F.cotn,R.N);return g.m(v,cj9(R,h),2);case 2:return g.m(v,tK(R,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:J=((a=F)==null?0:a.key)?g.lp(F.key).entityId:"";if(!J||!R.K){v.G$(5);break}return g.m(v,B0(J,R.K,R.D,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.m(v,tru(R.D,J),7);case 7:return g.m(v,zO(R,J),8);case 8:M=v.B,GO({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:J,jy:F,offlineModeType:M}),dx(R),P0(R),g.Na(v)}})},MM7=function(R,F,h){var a,J;
g.u(function(M){switch(M.D){case 1:if(!R.B)return KN(R,"onTransferProgress: "+F),M.return();if(R.B.transferState==="TRANSFER_STATE_TRANSFERRING"){M.G$(2);break}return g.m(M,R76(R),2);case 2:a=Date.now();if(!(a-R.fI>1E3)){M.G$(4);break}R.fI=a;return g.m(M,Kd7(R.D,h.videoId,h.D,h.fT,h.bytesDownloaded,h.B),5);case 5:if(R.C&&!(R.C&&a-R.oR>R.IR)){M.G$(4);break}R.oR=a;return g.m(M,zO(R,F),7);case 7:J=M.B,chG({videoId:F,jy:R.B,offlineModeType:J},h.bytesDownloaded,h.B);case 4:R.L.start(108E5),g.Na(M)}})},
vUt=function(R){var F=(R.B.transferRetryCount||0)<3;
F&&(R=R.B,R.transferRetryCount=(R.transferRetryCount||0)+1);return F},gU7=function(R,F){F=F===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":F;
var h,a,J,M;return g.u(function(v){if(v.D==1)return R.B||KN(R,"setTransferToFailed: "+F),h="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F==="TRANSFER_FAILURE_REASON_NETWORK"?h="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":F==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(h="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.m(v,tK(R,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",F),2);if(v.D!=3)return MB(R.aR,{entityKey:(a=R.B)==null?void 0:a.key,failureReason:h}),
J=R.B?g.lp(R.B.key).entityId:"",g.m(v,zO(R,J),3);M=v.B;var I={videoId:J,jy:R.B,offlineModeType:M},w=F,E={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};w&&(E.transferFailureReason=w,E.failureReason=FWh(w));GO(E,I);g.Na(v)})},tK=function(R,F,h,a){var J;
return g.u(function(M){if(M.D==1){if(!R.B)return KN(R,"saveTransferState: "+F),M.return();R.B.transferState=F;R.B.failureReason=a;g.Hi(M,2);return g.m(M,WdG(R,function(v){return h?Po(v,"offlineVideoStreams",R.B.offlineVideoStreams).then(function(I){for(var w=g.N(I),E=w.next();!E.done;E=w.next())if((E=E.value)&&E.streamsProgress){E=g.N(E.streamsProgress);for(var B=E.next();!B.done;B=E.next())B.value.streamState=h}return Jh7(v,I.filter(function(r){return!!r}),"offlineVideoStreams")}):g.Qe.resolve(void 0)}),
4)}if(M.D!=2)return g.yn(M,0);
J=g.f_(M);return J instanceof g.EU&&J.type==="QUOTA_EXCEEDED"?g.m(M,R.q_("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):M.G$(0)})},WdG=function(R,F){var h;
return g.u(function(a){if(!R.B)return a.return();h=R.B;return g.m(a,VR(R.D,{mode:"readwrite",qt:!0},function(J){var M=[Ky(J,h,"transfer")];F&&M.push(F(J));return g.Qe.all(M)}),0)})},dx=function(R){R.B=void 0;
R.N=void 0;R.L.stop()},Fnh=function(R,F){var h,a,J,M,v;
return g.u(function(I){if(I.D==1)return h=g.lp(F.key),a=h.entityId,J=g.DI(a,"playbackData"),g.m(I,Cy(R.D,J,"playbackData"),2);M=I.B;if((v=M)==null?0:v.playerResponseJson)return I.return(JSON.parse(M.playerResponseJson));throw Error("No PlayerResponse found");})},KN=function(R,F){R.api.dA("woffle",{mcte:F});
an("missing current transfer entity.")},zO=function(R,F){var h,a,J;
return g.u(function(M){if(M.D==1)return g.m(M,Cy(R.D,g.DI(F,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);h=M.B;return M.return((J=(a=h)==null?void 0:a.offlineModeType)!=null?J:void 0)})},h77=function(R){return GiU[R.transferState]!==void 0},al9=function(R,F){var h=GiU[R.transferState],a=GiU[F.transferState];
return h!==a?h-a:Number(R.enqueuedTimestampMs)-Number(F.enqueuedTimestampMs)},l$=function(R,F){var h=this;
this.uu=R;this.api=F;this.S=new g.un;this.N=new g.EJ;this.rf={Dp:function(){return h.K.rf.Dp()},
Ky:function(){return h.S},
o8u:function(){return h.K},
J9:function(){return h.J9()},
a6:function(){return h.a6()},
E8:function(){return h.E8()},
Uq:function(){return h.Uq()},
iC:function(){return h.iC()},
Kk:function(a){return h.Kk(a)}};
this.K=new tVU(function(){return IlL(h)},function(){h.E8()},this.api.RH(),this.api.X.bind(this.api));
this.B=new JK(this.api);lHk(this.K)},IlL=function(R){return g.u(function(F){R.api.WG("onOrchestrationBecameLeader");
return g.m(F,R.a6(),0)})},wsG=function(R){var F,h;
return g.u(function(a){if(a.D==1)return g.m(a,Wo(),2);if(a.D!=3){F=a.B;if(!F)return an("PES is undefined"),a.return();R.D=new lYk(F,R.api,R.K,R.B);h=R.HP(F);return g.m(a,yjL(F,h,R.K,R.B,R.uu),3)}R.Y=a.B;return g.m(a,iW4(R),0)})},iW4=function(R){var F;
return g.u(function(h){switch(h.D){case 1:if(!R.D)return an("transferManager is undefined"),h.return();if(R.D.B){h.G$(2);break}return g.m(h,P0(R.D),2);case 2:if(!R.uu.X("woffle_enable_main_downloads_library")){h.G$(4);break}return g.m(h,R.dC(),4);case 4:if(!R.uu.X("html5_offline_playback_position_sync")){h.G$(6);break}return g.m(h,R.Tj(),7);case 7:return g.m(h,R.Kk(864E5),6);case 6:return g.m(h,R.refreshAllStaleEntities(43200,!0),9);case 9:return g.m(h,R.GC(),10);case 10:if(!R.uu.X("html5_retry_downloads_for_expiration")){h.G$(11);
break}return g.m(h,R.iC(),11);case 11:return R.Z=g.B6(function(){R.refreshAllStaleEntities(43200,!0);R.GC()},9E5),g.D1(g.UK(),function(){return R.Uq()}),g.m(h,Wo(),13);
case 13:return F=h.B,g.m(h,K74(F),14);case 14:DWe(R.K),g.Na(h)}})},EU4=function(){var R,F,h,a,J,M;
return g.u(function(v){switch(v.D){case 1:return g.m(v,Wo(),2);case 2:R=v.B;if(!R)return v.return([]);F=Date.now()/1E3;return g.m(v,co(R,"offlineVideoPolicy"),3);case 3:h=v.B,a=g.N(h),J=a.next();case 4:if(J.done){v.G$(6);break}M=J.value;if(!(M.expirationTimestamp&&Number(M.expirationTimestamp)<F)){v.G$(5);break}M.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";M.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.m(v,U9(R,M,"offlineVideoPolicy"),5);
case 5:J=a.next();v.G$(4);break;case 6:return v.return(h.map(function(I){return I.key}))}})},Dc=function(R,F,h,a,J){var M,v,I;
return g.u(function(w){if(w.D==1)return g.m(w,Wo(),2);M=w.B;if(!M)return w.return([]);v=F.map(function(E){var B=g.DI(E,h);B={actionType:a,entityKey:B,actionMetadata:Object.assign({},vyU(),J)};a!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(B.actionMetadata.priority=0);E=new pN(h,E,B);return Qy(E)});
I=Bq7(M,v);lHk(R.K);return w.return(I)})},BA6=function(R,F,h,a){var J,M,v,I,w,E,B,r;
return g.u(function(Y){switch(Y.D){case 1:J=[],M=g.N(F),v=M.next();case 2:if(v.done){Y.G$(4);break}I=v.value;if(I.upToDate||h&&!I.shouldAutoSyncMetadata||!I.playlistId){Y.G$(3);break}w={};switch(a){case "mainPlaylistEntity":E={nextAutoRefreshIntervalSeconds:I.checkInSeconds,autoSync:h};w={mainPlaylistEntityActionMetadata:E};break;case "musicPlaylist":B={autoSync:h},w={musicPlaylistEntityActionMetadata:B}}return g.m(Y,Dc(R,[I.playlistId],a,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",w),6);case 6:(r=
Y.B)&&J.push.apply(J,g.S(r));case 3:v=M.next();Y.G$(2);break;case 4:return Y.return(J)}})},r$9=function(R,F){var h;
return g.u(function(a){return F.length?(h=vyU(),g.S2(h,Oh,{isEnqueuedForExpiredStreamUrlRefetch:!0}),R.api.dA("qrd",{v:F.length}),a.return(Dc(R,F,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h))):a.return([])})},YNh=function(R,F,h){this.B=R;
this.uu=F;this.K=h},kiv=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b;
return g.u(function(O){switch(O.D){case 1:return h=In(F),a=g.lp(F.entityKey),J=a.entityId,M=[],g.Hi(O,2),g.m(O,sp6(R,J),4);case 4:M=O.B;if(!(R.uu.X("woffle_enable_main_downloads_library")&&((v=M)==null?0:v.length))){O.G$(5);break}return g.m(O,Qjh(R.B,[F.entityKey]),5);case 5:g.yn(O,3);break;case 2:return I=g.f_(O),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I instanceof g.EU&&I.type==="QUOTA_EXCEEDED"?(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):an("Playlist add error"),O.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,w,E));case 3:B=[];if(!R.uu.X("html5_offline_prevent_redownload_downloaded_video")){O.G$(7);break}return g.m(O,J1h(R.B,"mainVideoEntity",M),8);case 8:M=O.B;case 7:if((r=M)==null?0:r.length)for(Y=g.N(M),p=Y.next();!p.done;p=Y.next())if(k=p.value,H=k.offlineVideoData,T=void 0,(T=H)==null?0:T.videoId)Z=void 0,b=Number(((Z=F.actionMetadata)==null?void 0:Z.priority)||
0)+1,B.push(b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",H.videoId,"mainVideoEntity",b,Vy,ps7(F,H,J)));return O.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,B))}})},$Eg=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O,n,K,Rg,U,vi,GI,gL,Em,hf,qa,m2,Ru,ng,$7,eB,ch,Y7,Kg,hX,f,Xl,b9,ag,fg,L,Fi,KM,gU,u9,K_,ci,CM,eP,y,x,q,X,P,Bi,l,c,e,b7,Pi,Ig,i9,jB,xL,RG,Lg,Xk,TI,NS,ZT,S6,Te;
return g.u(function(GD){switch(GD.D){case 1:return h=In(F),a=F.entityKey,J=g.lp(a).entityId,M=[],v=!1,J==="!*$_ALL_ENTITIES_!*$"?(v=!0,g.m(GD,co(R.B,"mainPlaylistEntity"),5)):g.m(GD,Cy(R.B,a,"mainPlaylistEntity"),4);case 4:(I=GD.B)&&M.push(I);GD.G$(3);break;case 5:M=GD.B;case 3:if((w=M)==null||!w.length)return GD.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));E=g.t(F.actionMetadata,Qp6);r=(B=E)==null?void 0:B.nextAutoRefreshIntervalSeconds;p=(Y=E)==null?void 0:Y.autoSync;k=[];T=H=
!0;Z=!1;if(!v&&p===!1){GD.G$(6);break}g.Hi(GD,7);return g.m(GD,SJh(0,!!p,!0,M),9);case 9:k=GD.B;g.yn(GD,8);break;case 7:b=g.f_(GD);if(!(b instanceof Error&&b.message==="No data")){b instanceof Error&&b.message==="Empty response body"&&an(b.message);GD.G$(8);break}return J==="!*$_ALL_ENTITIES_!*$"?g.m(GD,BzG(R.B,F,R.K,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.m(GD,wYh(J,R.B,F,R.K),8);case 8:if(!k.length||!v&&k[0].playlistId!==J)return GD.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h));case 6:if(v){O=[];n=g.N(k);for(K=n.next();!K.done;K=n.next())Rg=K.value,Rg.upToDate||p&&!Rg.shouldAutoSyncMetadata||!Rg.playlistId||(U={nextAutoRefreshIntervalSeconds:Rg.checkInSeconds,autoSync:p},O.push(b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Rg.playlistId,"mainPlaylistEntity",0,Vy,{mainPlaylistEntityActionMetadata:U})));return GD.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,O))}k.length&&(vi=k[0],Z=!!vi.upToDate,p&&(H=(GI=vi.shouldAutoSyncMetadata)!=null?GI:!0,T=(gL=
vi.shouldAutoSyncVideos)!=null?gL:!0,vi.checkInSeconds&&(r=vi.checkInSeconds)));if(Z||!H)return GD.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));Em=[];hf=M[0];if(!hf.downloadState){qa=void 0;GD.G$(15);break}return g.m(GD,Cy(R.B,hf.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:qa=GD.B;case 15:return m2=qa,ng=((Ru=m2)==null?0:Ru.addedTimestampMillis)?String(m2.addedTimestampMillis):void 0,g.Hi(GD,17),g.m(GD,sp6(R,J,ng,r),19);case 19:Em=GD.B;g.yn(GD,18);break;case 17:$7=
g.f_(GD);if(!($7 instanceof Error&&$7.message==="No data for playlist")){if($7 instanceof Error&&$7.message==="Empty response body for playlist")an($7.message);else return eB="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",ch="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",$7 instanceof g.EU&&$7.type==="QUOTA_EXCEEDED"&&(eB="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",ch="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),GD.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
h,void 0,eB,ch));GD.G$(18);break}return g.m(GD,wYh(J,R.B,F,R.K),18);case 18:if(!T)return GD.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));Y7=[];Kg=new Map;if((hX=Em)==null?0:hX.length)for(f=g.N(Em),Xl=f.next();!Xl.done;Xl=f.next())b9=Xl.value,ag=b9.offlineVideoData,fg=void 0,((fg=ag)==null?0:fg.videoId)&&Kg.set(ag.videoId,ag);L=new Map;Fi=[];if((KM=hf)==null?0:(gU=KM.videos)==null?0:gU.length)for(u9=g.N(hf.videos),K_=u9.next();!K_.done;K_=u9.next())if(ci=K_.value,CM=JSON.parse(g.lp(ci).entityId),
eP=CM.videoId)Kg.has(eP)?(L.set(eP,Kg.get(eP)),Kg.delete(eP)):Fi.push(eP);x=Number(((y=F.actionMetadata)==null?void 0:y.priority)||0)+1;q=g.N(Kg.entries());for(X=q.next();!X.done;X=q.next())P=X.value,Bi=g.N(P),l=Bi.next().value,c=Bi.next().value,e=l,b7=c,Y7.push(b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e,"mainVideoEntity",x,Vy,ps7(F,b7,J)));Pi=g.N(L.entries());for(Ig=Pi.next();!Ig.done;Ig=Pi.next())i9=Ig.value,jB=g.N(i9),xL=jB.next().value,RG=jB.next().value,Lg=xL,Xk=RG,Y7.push(b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Lg,"mainVideoEntity",x,Vy,ps7(F,Xk,J)));TI=g.N(Fi);for(NS=TI.next();!NS.done;NS=TI.next())ZT=NS.value,S6={playlistId:J},Te={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:S6},Y7.push(b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",ZT,"mainVideoEntity",0,Vy,Te));return GD.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,Y7))}})},A$4=function(R,F){var h,a,J,M;
return g.u(function(v){switch(v.D){case 1:return h=In(F),g.Hi(v,2),a=g.lp(F.entityKey).entityId,a==="!*$_ALL_ENTITIES_!*$"?g.m(v,BzG(R.B,F,R.K,(J=F.actionMetadata)==null?void 0:(M=J.offlineLoggingData)==null?void 0:M.offlineDeleteReason),5):g.m(v,wYh(a,R.B,F,R.K),6);case 6:if(!R.uu.X("woffle_enable_main_downloads_library")){v.G$(5);break}return g.m(v,$K7(R.B,F.entityKey),5);case 5:g.yn(v,3);break;case 2:return g.f_(v),v.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return v.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h))}})},sp6=function(R,F,h,a){var J,M,v,I,w,E,B;
return g.u(function(r){switch(r.D){case 1:return g.m(r,ZVG([F]),2);case 2:return J=r.B,g.m(r,xEv(R,J[0],h,a),3);case 3:return M=r.B,v=M.mainPlaylistEntity,I=M.wcR,E=I_v(v,(w=I)==null?void 0:w.avatar),g.Hi(r,4),g.m(r,AK(E),6);case 6:g.yn(r,5);break;case 4:B=g.f_(r),B instanceof Error&&B.message==="Failed to fetch"&&an(B.message);case 5:return r.return(J[0].videos)}})},xEv=function(R,F,h,a){var J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O,n;
return g.u(function(K){switch(K.D){case 1:J=Date.now().toString();h||(h=J);M=F.videos;v=F.playlistId;I=[];w=[];if(M)for(E=g.N(M),B=E.next();!B.done;B=E.next()){r=B.value;Y=r.offlineVideoData;if(!Y||!Y.videoId)throw an("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");p=Y.videoId;k={videoId:p,playlistId:v};H={id:g.DI(JSON.stringify(k),"mainPlaylistVideoEntity"),video:g.DI(p,"mainVideoEntity")};I.push(H);w.push(H.id)}Z={key:g.DI(v,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:h,lastSyncedTimestampMillis:J};b={key:g.DI(v,"mainPlaylistEntity"),playlistId:v,videos:w,title:F.title,thumbnailStyleData:NA7(F),visibility:HWg(F),downloadState:Z.key};F.channel&&(O=F.channel.offlineChannelData,T=Ln4(g.DI(v,"ytMainChannelEntity"),O),b.channelOwner=T.id);((n=b)==null?0:n.entityMetadata)?(b.entityMetadata.offlineLastModifiedTimestampSeconds=F.lastModifiedTimestamp,a&&(b.entityMetadata.nextAutoRefreshIntervalSeconds=String(a))):b&&(b.entityMetadata={nextAutoRefreshIntervalSeconds:a?
String(a):void 0,offlineLastModifiedTimestampSeconds:F.lastModifiedTimestamp});g.Hi(K,2);return g.m(K,VR(R.B,{mode:"readwrite",qt:!0},function(Rg){var U=Ky(Rg,b,"mainPlaylistEntity"),vi=Ky(Rg,Z,"mainPlaylistDownloadStateEntity");U=[U,vi];vi=g.N(I);for(var GI=vi.next();!GI.done;GI=vi.next())U.push(Ky(Rg,GI.value,"mainPlaylistVideoEntity"));T&&U.push(Ky(Rg,T,"ytMainChannelEntity"));return g.Qe.all(U)}),4);
case 4:g.yn(K,3);break;case 2:throw g.f_(K),an("PES failure for playlist"),Error("PES failure for playlist");case 3:return K.return({mainPlaylistEntity:b,wcR:T,l0o:I})}})},Ln4=function(R,F){return{id:R,
channelId:F.channelId,title:F.title,avatar:F.thumbnail}},NA7=function(R){var F=[],h=R.videos;
h&&h.length>0&&F.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:h[0].offlineVideoData.thumbnail}}});if((R=R.additionalMetadadatas)&&R.length>0)for(R=g.N(R),h=R.next();!h.done;h=R.next()){var a=h.value.offlineBundleItemPlaylistData,J=void 0;h=(J=a)==null?void 0:J.style;J=void 0;a={collageThumbnail:{coverThumbnail:(J=a)==null?void 0:J.coverThumbnail}};switch(h){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":F.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:a});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":F.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:a});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":F.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:a});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":F.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:a})}}return F},HWg=function(R){switch(R.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},ps7=function(R,F,h){F={offlineVideoData:F,
playlistId:h};if(R=g.t(R.actionMetadata,Qp6))F.maximumDownloadQuality=R.maximumDownloadQuality;return{mainVideoEntityActionMetadata:F}},TAt=function(R,F,h){this.B=R;
this.uu=F;this.K=h},flL=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p,k;
return g.u(function(H){switch(H.D){case 1:return h=In(F),a=g.lp(F.entityKey),J=a.entityId,M=g.t(F.actionMetadata,Uh),I=!((v=M)==null?0:v.playlistId),g.Hi(H,2),g.m(H,y$L(R,J,void 0,(w=M)==null?void 0:w.offlineVideoData,I),4);case 4:g.yn(H,3);break;case 2:return E=g.f_(H),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.EU&&E.type==="QUOTA_EXCEEDED"&&(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
H.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,B,r));case 3:Y=1;Y=Number(((p=F.actionMetadata)==null?void 0:p.priority)||0)+1;var T=(T=g.t(F.actionMetadata,Uh))?{playbackDataActionMetadata:{maximumDownloadQuality:T.maximumDownloadQuality}}:void 0;k=b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J,"playbackData",Y,qNh,T);return H.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,[k]))}})},jpG=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b;
return g.u(function(O){switch(O.D){case 1:return h=In(F),a=g.lp(F.entityKey),J=a.entityId,g.m(O,Cy(R.B,F.entityKey,"mainVideoEntity"),2);case 2:M=O.B;if(!M){v=void 0;O.G$(3);break}return g.m(O,Cy(R.B,M.downloadState,"mainVideoDownloadStateEntity"),4);case 4:v=O.B;case 3:I=v;if(!M||!I)return O.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));g.Hi(O,5);return g.m(O,y$L(R,J,I.addedTimestampMillis,(E=g.t(F.actionMetadata,Uh))==null?void 0:E.offlineVideoData),7);case 7:B=1;B=Number(((r=
F.actionMetadata)==null?void 0:r.priority)||0)+1;w=b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",J,"playbackData",B,qNh);g.yn(O,6);break;case 5:Y=g.f_(O);if(!(Y instanceof Error&&Y.message==="No data")){if(Y instanceof Error&&Y.message==="Empty response body")an(Y.message);else return p="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Y instanceof g.EU&&Y.type==="QUOTA_EXCEEDED"&&(p="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),O.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,p,k));O.G$(6);break}return g.m(O,H0(R.B,J),9);case 9:H=O.B;T=g.t(F.actionMetadata,Uh);if(b=(Z=T)==null?void 0:Z.playlistId)H.playlistId=b;H.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.m(O,xD(J,R.B,F,R.K,H),6);case 6:return O.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,w?[w]:void 0))}})},ZW4=function(R,F){var h,a,J,M,v,I,w,E,B,r;
return g.u(function(Y){switch(Y.D){case 1:return h=In(F),g.Hi(Y,2),a=g.lp(F.entityKey).entityId,a==="!*$_ALL_ENTITIES_!*$"?g.m(Y,BzG(R.B,F,R.K,(B=F.actionMetadata)==null?void 0:(r=B.offlineLoggingData)==null?void 0:r.offlineDeleteReason),5):g.m(Y,H0(R.B,a),6);case 6:J=Y.B;M=g.t(F.actionMetadata,Uh);if(I=(v=M)==null?void 0:v.playlistId)J.playlistId=I;J.offlineDeleteReason=(w=F.actionMetadata)==null?void 0:(E=w.offlineLoggingData)==null?void 0:E.offlineDeleteReason;return g.m(Y,xD(a,R.B,F,R.K,J),7);
case 7:if(!R.uu.X("woffle_enable_main_downloads_library")){Y.G$(5);break}return g.m(Y,$K7(R.B,F.entityKey),5);case 5:g.yn(Y,3);break;case 2:return g.f_(Y),Y.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Y.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h))}})},y$L=function(R,F,h,a,J){var M,v,I,w,E,B;
return g.u(function(r){switch(r.D){case 1:if(M=a){r.G$(2);break}return g.m(r,jj9([F]),3);case 3:v=r.B,M=v[0];case 2:return g.m(r,bWh(R,M,h,J),4);case 4:I=r.B;w=I.mainVideoEntity;E=I.channelEntity;g.Hi(r,5);var Y=sh(w.thumbnail),p=sh(E.avatar);return g.m(r,AK(Y.concat(p)),7);case 7:g.yn(r,0);break;case 5:B=g.f_(r),B instanceof Error&&B.message==="Failed to fetch"&&an(B.message),g.Na(r)}})},bWh=function(R,F,h,a){var J,M,v,I,w,E,B,r,Y,p,k,H,T;
return g.u(function(Z){switch(Z.D){case 1:h||(h=Date.now().toString());M=(J=F.channel)==null?void 0:J.offlineChannelData;v={id:g.DI(F.videoId,"ytMainChannelEntity"),channelId:M.channelId,title:M.title,avatar:M.thumbnail};I={key:g.DI(F.videoId,"mainVideoDownloadStateEntity"),playbackData:g.DI(F.videoId,"playbackData"),addedTimestampMillis:h,videoDownloadContextEntity:g.DI(F.videoId,"videoDownloadContextEntity")};w={key:g.DI(F.videoId,"videoPlaybackPositionEntity"),videoId:F.videoId,lastPlaybackPositionSeconds:"0"};
R.uu.X("html5_offline_playback_position_sync")&&(E={playbackPosition:w.key});B=g.DI(F.videoId,"mainVideoEntity");r={key:B,videoId:F.videoId,title:F.title,thumbnail:F.thumbnail,localizedStrings:{viewCount:F.shortViewCountText},userState:E,lengthSeconds:F.lengthSeconds?Number(F.lengthSeconds):void 0,publishedTimestampMillis:F.publishedTimestamp?(Number(F.publishedTimestamp)*1E3).toString():void 0,formattedDescription:F.description,owner:v.id,downloadState:I.key};if(!R.uu.X("woffle_enable_main_downloads_library")||
!a){Z.G$(2);break}return g.m(Z,kn7(R.B,[B]),3);case 3:if(k=Z.B)Y=k.mainDownloadsLibraryEntity,p=k.mainDownloadsListEntity;case 2:return T=a_L,H={key:g.DI(F.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.S2(I,T,H),g.m(Z,VR(R.B,{mode:"readwrite",qt:!0},function(b){var O=Ky(b,v,"ytMainChannelEntity"),n=Ky(b,I,"mainVideoDownloadStateEntity"),K=Ky(b,r,"mainVideoEntity");O=[O,n,K];R.uu.X("html5_offline_playback_position_sync")&&(n=Ky(b,w,"videoPlaybackPositionEntity"),
O.push(n));Y&&(n=Ky(b,Y,"mainDownloadsLibraryEntity"),O.push(n));p&&(n=Ky(b,p,"mainDownloadsListEntity"),O.push(n));H&&(b=Ky(b,H,"downloadStatusEntity"),O.push(b));return g.Qe.all(O)}),4);
case 4:return Z.return({mainVideoEntity:r,channelEntity:v})}})},SN9=function(R,F,h){this.B=R;
this.uu=F;this.K=h},mEv=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O,n,K,Rg,U,vi,GI,gL,Em,hf;
return g.u(function(qa){switch(qa.D){case 1:return h=In(F),a=[],g.m(qa,es.getInstance(),2);case 2:J=qa.B;if(!J){qa.G$(3);break}return g.m(qa,J.get("sdois"),4);case 4:return M=qa.B,g.m(qa,(I=J)==null?void 0:I.get("lmqf"),5);case 5:v=qa.B;case 3:g.Hi(qa,6);if(M===void 0)throw Error("prefStorage or opt-in state is undefined");w=[];if(M){qa.G$(8);break}return g.m(qa,pYh(R.B),9);case 9:w=qa.B,w.reverse();case 8:if(!w.length){qa.G$(10);break}E=g.N(w);B=E.next();case 11:if(B.done){qa.G$(10);break}r=B.value;
if(!r){qa.G$(12);break}Y=g.lp(r).entityId;return g.m(qa,H0(R.B,Y),14);case 14:return p=qa.B,p.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.m(qa,xD(Y,R.B,{entityKey:r,actionType:F.actionType},R.K,p),12);case 12:B=E.next();qa.G$(11);break;case 10:return g.m(qa,mKU(M,(k=v)!=null?k:"SD"),16);case 16:return H=qa.B,g.m(qa,r17(H),17);case 17:T=sj4(H);if(!R.uu.X("woffle_enable_main_downloads_library")){qa.G$(18);break}if(M){qa.G$(19);break}return g.m(qa,$K7(R.B,g.d8),19);case 19:return g.m(qa,
Qjh(R.B,[g.d8]),18);case 18:if((Z=T)==null?0:Z.length)for(b=g.N(T),O=b.next();!O.done;O=b.next())if(K=n=O.value,Rg=K.actionType,U=K.entityKey,vi=K.actionMetadata,Rg&&U&&vi&&!g.t(vi,OWg)){Rg==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(vi.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(GI=g.t(n.actionMetadata,Uh))GI.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",n.actionMetadata=Object.assign({},n.actionMetadata,{mainVideoEntityActionMetadata:GI});a.push(n)}g.yn(qa,
7);break;case 6:return gL=g.f_(qa),Em="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",hf="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",gL instanceof g.EU&&gL.type==="QUOTA_EXCEEDED"&&(Em="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",hf="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),qa.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,Em,hf));case 7:return qa.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,a))}})},oUL=function(){l$.apply(this,
arguments);
this.C="mainVideoEntity"},Xs4=function(R,F,h){F=F===void 0?43200:F;
h=h===void 0?!0:h;var a=a===void 0?!1:a;var J,M,v;return g.u(function(I){switch(I.D){case 1:if(!R.S.sT())return I.return([]);J=[];g.Hi(I,2);return g.m(I,SJh(F,h,a),4);case 4:J=I.B;g.yn(I,3);break;case 2:M=g.f_(I),M instanceof Error&&M.message==="No data"||M instanceof Error&&M.message==="Empty response body"&&an(M.message);case 3:return v=BA6(R,J,h,"mainPlaylistEntity"),I.return(v)}})},e7e=function(R,F,h,a){a=a===void 0?!1:a;
var J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b;return g.u(function(O){switch(O.D){case 1:return J=[],g.m(O,OV9(),2);case 2:return(M=O.B)||a?g.m(O,oyk(F,h),3):O.return([]);case 3:v=O.B;if((I=v)==null||!I.length)return O.return([]);w={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};E=g.N(v);B=E.next();case 4:if(B.done){O.G$(6);break}Y=r=B.value;p=Y.actionType;k=Y.entityKey;H=Y.actionMetadata;if(!(p&&k&&H)||g.t(H,OWg)){O.G$(5);break}p==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(H.offlineLoggingData=
w);T=g.lp(k);Z=T.entityId;return g.m(O,Dc(R,[Z],"mainVideoEntity",p,H),8);case 8:b=O.B,J=J.concat(b);case 5:B=E.next();O.G$(4);break;case 6:return O.return(J)}})},nUv=function(R,F){this.B=R;
this.K=F},dE7=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p,k,H,T,Z;
return g.u(function(b){switch(b.D){case 1:return h=In(F),a=g.lp(F.entityKey),J=a.entityId,M=[],g.Hi(b,2),g.m(b,ugU(R,J),4);case 4:M=b.B;if((v=M)==null||!v.length){b.G$(5);break}return g.m(b,LW7(R.B,F.entityKey),5);case 5:g.yn(b,3);break;case 2:return I=g.f_(b),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I instanceof g.EU&&I.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
b.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,w,E));case 3:return B=[],g.m(b,J1h(R.B,"musicTrack",M),7);case 7:M=b.B;if(M.length)for(r=g.N(M),Y=r.next();!Y.done;Y=r.next())if(p=Y.value,k=p.offlineVideoData,H=void 0,(H=k)==null?0:H.videoId)T=void 0,Z=Number(((T=F.actionMetadata)==null?void 0:T.priority)||0)+1,B.push(b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k.videoId,"musicTrack",Z,CN,qB(F,k,J)));return b.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,B))}})},
Pyu=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O,n,K,Rg,U,vi,GI,gL,Em,hf,qa,m2,Ru,ng,$7,eB,ch,Y7,Kg,hX,f,Xl,b9,ag,fg,L,Fi,KM,gU,u9,K_,ci,CM,eP,y,x,q,X,P,Bi,l,c;
return g.u(function(e){switch(e.D){case 1:return h=In(F),a=F.entityKey,J=g.lp(a).entityId,M=[],v=!1,J==="!*$_ALL_ENTITIES_!*$"?(v=!0,g.m(e,co(R.B,"musicAlbumRelease"),5)):g.m(e,Cy(R.B,a,"musicAlbumRelease"),4);case 4:(I=e.B)&&M.push(I);e.G$(3);break;case 5:M=e.B;case 3:if((w=M)==null||!w.length)return e.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));if(v){E=[];B=g.N(M);for(r=B.next();!r.done;r=B.next())Y=r.value,p=g.lp(Y.id).entityId,E.push(b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
p,"musicAlbumRelease",0,CN));return e.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,E))}k=[];H=M[0];T=void 0;if(!H.downloadMetadata){e.G$(6);break}return g.m(e,Cy(R.B,H.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:Z=e.B,T=Number((O=(b=Z)==null?void 0:b.addedTimestampMillis)!=null?O:"0")/1E3;case 6:return g.Hi(e,8),g.m(e,ugU(R,J,(n=T)==null?void 0:n.toString()),10);case 10:k=e.B;g.yn(e,9);break;case 8:K=g.f_(e);if(!(K instanceof Error&&K.message==="No data")){if(K instanceof
Error&&K.message==="Empty response body")an(K.message);else return Rg="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",K instanceof g.EU&&K.type==="QUOTA_EXCEEDED"&&(Rg="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),e.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,Rg,U));e.G$(9);break}return g.m(e,TO(J,"musicAlbumRelease",R.B,F,R.K),9);case 9:vi=[];GI=
new Map;if((gL=k)==null?0:gL.length)for(Em=g.N(k),hf=Em.next();!hf.done;hf=Em.next())qa=hf.value,m2=qa.offlineVideoData,Ru=void 0,((Ru=m2)==null?0:Ru.videoId)&&GI.set(m2.videoId,m2);ng=new Map;$7=[];if((eB=H)==null?0:(ch=eB.tracks)==null?0:ch.length)for(Y7=g.N(H.tracks),Kg=Y7.next();!Kg.done;Kg=Y7.next())if(hX=Kg.value,f=g.lp(hX).entityId)GI.has(f)?(ng.set(f,GI.get(f)),GI.delete(f)):$7.push(f);b9=Number(((Xl=F.actionMetadata)==null?void 0:Xl.priority)||0)+1;ag=g.N(GI.entries());for(fg=ag.next();!fg.done;fg=
ag.next())L=fg.value,Fi=g.N(L),KM=Fi.next().value,gU=Fi.next().value,u9=KM,K_=gU,vi.push(b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",u9,"musicTrack",b9,CN,qB(F,K_)));ci=g.N(ng.entries());for(CM=ci.next();!CM.done;CM=ci.next())eP=CM.value,y=g.N(eP),x=y.next().value,q=y.next().value,X=x,P=q,vi.push(b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",X,"musicTrack",b9,CN,qB(F,P)));Bi=g.N($7);for(l=Bi.next();!l.done;l=Bi.next())c=l.value,vi.push(b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",c,"musicTrack",
0,CN));return e.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,vi))}})},z76=function(R,F){var h,a;
return g.u(function(J){switch(J.D){case 1:return h=In(F),g.Hi(J,2),a=g.lp(F.entityKey).entityId,a==="!*$_ALL_ENTITIES_!*$"?g.m(J,yy(R.B,F,R.K),5):g.m(J,TO(a,"musicAlbumRelease",R.B,F,R.K),6);case 6:return g.m(J,Tz7(R.B,F.entityKey),5);case 5:g.yn(J,3);break;case 2:return g.f_(J),J.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},ugU=function(R,F,h){var a,J,M;
return g.u(function(v){switch(v.D){case 1:return g.m(v,ZVG([F]),2);case 2:return a=v.B,g.m(v,Kng(R,a[0],h),3);case 3:return J=v.B,M=sh(J.thumbnailDetails),g.m(v,AK(M),4);case 4:return v.return(a[0].videos)}})},Kng=function(R,F,h){var a,J,M,v,I,w,E,B,r,Y,p,k,H,T;
return g.u(function(Z){if(Z.D==1){a=F.additionalMetadadatas;J=void 0;if(a&&a.length>0)for(M=g.N(a),v=M.next();!v.done;v=M.next())if(I=v.value,I.offlineMusicPlaylistData){J=I.offlineMusicPlaylistData;break}w=F.playlistId;E=y1k(F);B=E.Ep;r=E.Dm;Y=h?(Number(h)*1E3).toString():Date.now().toString();p=F.lastModifiedTimestamp?(Number(F.lastModifiedTimestamp)*1E3).toString():"0";k={id:g.DI(w,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:r,lastModifiedTimestampMillis:p,addedTimestampMillis:Y,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};H={id:g.DI(w,"musicAlbumRelease"),title:F.title,audioPlaylistId:w,trackCount:F.totalVideoCount,tracks:B,downloadMetadata:k.id};J&&(H.thumbnailDetails=(T=J.albumHqThumbnail)!=null?T:J.albumArtistThumbnail,H.artistDisplayName=J.albumArtistDisplayName,H.releaseDate=J.albumReleaseDate,H.contentRating={explicitType:J.albumReleaseExplicitType},H.releaseType=J.albumReleaseType);return g.m(Z,VR(R.B,{mode:"readwrite",qt:!0},function(b){var O=Ky(b,H,"musicAlbumRelease");
b=Ky(b,k,"musicAlbumReleaseDownloadMetadataEntity");return g.Qe.all([O,b])}),2)}return Z.return(H)})},tMk=function(R,F){this.B=R;
this.K=F},DE9=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p,k,H,T,Z;
return g.u(function(b){switch(b.D){case 1:return h=In(F),a=g.lp(F.entityKey),J=a.entityId,M=[],g.Hi(b,2),g.m(b,ll7(R,J),4);case 4:M=b.B;if((v=M)==null||!v.length){b.G$(5);break}return g.m(b,LW7(R.B,F.entityKey),5);case 5:g.yn(b,3);break;case 2:return I=g.f_(b),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I instanceof g.EU&&I.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
b.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,w,E));case 3:return B=[],g.m(b,J1h(R.B,"musicTrack",M),7);case 7:M=b.B;if(M.length)for(r=g.N(M),Y=r.next();!Y.done;Y=r.next())if(p=Y.value,k=p.offlineVideoData,H=void 0,(H=k)==null?0:H.videoId)T=void 0,Z=Number(((T=F.actionMetadata)==null?void 0:T.priority)||0)+1,B.push(b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k.videoId,"musicTrack",Z,c0,qB(F,k,J)));return b.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,B))}})},
VM9=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O,n,K,Rg,U,vi,GI,gL,Em,hf,qa,m2,Ru,ng,$7,eB,ch,Y7,Kg,hX,f,Xl,b9,ag,fg,L,Fi,KM,gU,u9,K_,ci,CM,eP,y,x,q,X,P,Bi,l,c,e,b7,Pi,Ig,i9,jB,xL,RG,Lg,Xk,TI,NS;
return g.u(function(ZT){switch(ZT.D){case 1:return h=In(F),a=F.entityKey,J=g.lp(a).entityId,M=[],v=!1,J==="!*$_ALL_ENTITIES_!*$"?(v=!0,g.m(ZT,co(R.B,"musicPlaylist"),5)):g.m(ZT,Cy(R.B,a,"musicPlaylist"),4);case 4:(I=ZT.B)&&M.push(I);ZT.G$(3);break;case 5:M=ZT.B;case 3:if((w=M)==null||!w.length)return ZT.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));E=g.t(F.actionMetadata,qJ7);r=(B=E)==null?void 0:B.autoSync;Y=[];k=p=!0;H=!1;T=void 0;if(!v&&r===!1){ZT.G$(6);break}g.Hi(ZT,7);return g.m(ZT,
XYk(0,!!r,!0,M),9);case 9:Y=ZT.B;g.yn(ZT,8);break;case 7:Z=g.f_(ZT);if(!(Z instanceof Error&&Z.message==="No data")){Z instanceof Error&&Z.message==="Empty response body"&&an(Z.message);ZT.G$(8);break}return J==="!*$_ALL_ENTITIES_!*$"?g.m(ZT,yy(R.B,F,R.K),8):g.m(ZT,TO(J,"musicPlaylist",R.B,F,R.K),8);case 8:if(!Y.length||!v&&Y[0].playlistId!==J)return ZT.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));case 6:if(v){b=[];O=g.N(Y);for(n=O.next();!n.done;n=O.next())K=n.value,K.upToDate||
r&&!K.shouldAutoSyncMetadata||!K.playlistId||(Rg={autoSync:r},b.push(b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",K.playlistId,"musicPlaylist",0,c0,{musicPlaylistEntityActionMetadata:Rg})));return ZT.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,b))}Y.length&&(U=Y[0],H=!!U.upToDate,r&&(p=(vi=U.shouldAutoSyncMetadata)!=null?vi:!0,k=(GI=U.shouldAutoSyncVideos)!=null?GI:!0,U.checkInSeconds&&(T=U.checkInSeconds)));if(H||!p)return ZT.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h));gL=[];Em=M[0];hf=void 0;if(!Em.downloadMetadata){ZT.G$(15);break}return g.m(ZT,Cy(R.B,Em.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:qa=ZT.B,hf=Number((Ru=(m2=qa)==null?void 0:m2.addedTimestampMillis)!=null?Ru:"0")/1E3;case 15:return g.Hi(ZT,17),g.m(ZT,ll7(R,J,(ng=hf)==null?void 0:ng.toString(),T),19);case 19:gL=ZT.B;g.yn(ZT,18);break;case 17:$7=g.f_(ZT);if(!($7 instanceof Error&&$7.message==="No data")){if($7 instanceof Error&&$7.message==="Empty response body")an($7.message);
else return eB="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",ch="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",$7 instanceof g.EU&&$7.type==="QUOTA_EXCEEDED"&&(eB="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",ch="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),ZT.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,eB,ch));ZT.G$(18);break}return g.m(ZT,TO(J,"musicPlaylist",R.B,F,R.K),18);case 18:if(!k)return ZT.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h));Y7=[];Kg=new Map;if((hX=gL)==null?0:hX.length)for(f=g.N(gL),Xl=f.next();!Xl.done;Xl=f.next())b9=Xl.value,ag=b9.offlineVideoData,fg=void 0,((fg=ag)==null?0:fg.videoId)&&Kg.set(ag.videoId,ag);L=new Map;Fi=[];if((KM=Em)==null?0:(gU=KM.tracks)==null?0:gU.length)for(u9=g.N(Em.tracks),K_=u9.next();!K_.done;K_=u9.next())if(ci=K_.value,CM=g.lp(ci).entityId)Kg.has(CM)?(L.set(CM,Kg.get(CM)),Kg.delete(CM)):Fi.push(CM);y=Number(((eP=F.actionMetadata)==null?void 0:eP.priority)||0)+1;x=g.N(Kg.entries());for(q=
x.next();!q.done;q=x.next())X=q.value,P=g.N(X),Bi=P.next().value,l=P.next().value,c=Bi,e=l,Y7.push(b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c,"musicTrack",y,c0,qB(F,e)));b7=g.N(L.entries());for(Pi=b7.next();!Pi.done;Pi=b7.next())Ig=Pi.value,i9=g.N(Ig),jB=i9.next().value,xL=i9.next().value,RG=jB,Lg=xL,Y7.push(b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",RG,"musicTrack",y,c0,qB(F,Lg)));Xk=g.N(Fi);for(TI=Xk.next();!TI.done;TI=Xk.next())NS=TI.value,Y7.push(b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
NS,"musicTrack",0,c0));return ZT.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,Y7))}})},UEv=function(R,F){var h,a;
return g.u(function(J){switch(J.D){case 1:return h=In(F),g.Hi(J,2),a=g.lp(F.entityKey).entityId,a==="!*$_ALL_ENTITIES_!*$"?g.m(J,yy(R.B,F,R.K),5):g.m(J,TO(a,"musicPlaylist",R.B,F,R.K),6);case 6:return g.m(J,Tz7(R.B,F.entityKey),5);case 5:g.yn(J,3);break;case 2:return g.f_(J),J.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},ll7=function(R,F,h,a){var J,M,v;
return g.u(function(I){switch(I.D){case 1:return g.m(I,ZVG([F]),2);case 2:return J=I.B,g.m(I,Cyh(R,J[0],h,a),3);case 3:return M=I.B,v=sh(M.thumbnailDetails),g.m(I,AK(v),4);case 4:return I.return(J[0].videos)}})},Cyh=function(R,F,h,a){var J,M,v,I,w,E,B,r,Y;
return g.u(function(p){return p.D==1?(J=F.playlistId,M=y1k(F),v=M.Ep,I=M.Dm,w=h?(Number(h)*1E3).toString():Date.now().toString(),E=F.lastModifiedTimestamp?(Number(F.lastModifiedTimestamp)*1E3).toString():"0",B={id:g.DI(J,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:I,lastModifiedTimestampMillis:E,addedTimestampMillis:w,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},r={id:g.DI(J,"musicPlaylist"),title:F.title,playlistId:J,thumbnailDetails:F.thumbnail,visibility:c$g(F),trackCount:F.totalVideoCount,
tracks:v,downloadMetadata:B.id},a&&(((Y=r)==null?0:Y.entityMetadata)?r.entityMetadata.nextAutoRefreshIntervalSeconds=String(a):r&&(r.entityMetadata={nextAutoRefreshIntervalSeconds:String(a)})),g.m(p,VR(R.B,{mode:"readwrite",qt:!0},function(k){var H=Ky(k,r,"musicPlaylist");k=Ky(k,B,"musicPlaylistDownloadMetadataEntity");return g.Qe.all([H,k])}),2)):p.return(r)})},c$g=function(R){switch(R.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},Wnv=function(R,F){this.B=R;
this.K=F},aPG=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p,k;
return g.u(function(H){switch(H.D){case 1:return h=In(F),a=g.lp(F.entityKey),J=a.entityId,M=g.t(F.actionMetadata,Ri6),g.Hi(H,2),g.m(H,Fw6(R,J,void 0,(v=M)==null?void 0:v.track,(I=M)==null?void 0:I.albumRelease),4);case 4:if((w=M)==null?0:w.playlistId){H.G$(5);break}return g.m(H,LW7(R.B,F.entityKey),5);case 5:g.yn(H,3);break;case 2:return E=g.f_(H),B="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.EU&&E.type==="QUOTA_EXCEEDED"&&
(B="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),H.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,B,r));case 3:p=Number(((Y=F.actionMetadata)==null?void 0:Y.priority)||0)+1;var T=(T=g.t(F.actionMetadata,Ri6))?{playbackDataActionMetadata:{maximumDownloadQuality:T.maximumDownloadQuality}}:void 0;k=b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J,"playbackData",p,hi7,T);return H.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h,[k]))}})},Jih=function(R,F){var h,a,J,M,v,I,w,E,B,r,Y,p,k,H,T;
return g.u(function(Z){switch(Z.D){case 1:return h=In(F),a=g.lp(F.entityKey),J=a.entityId,g.m(Z,Cy(R.B,F.entityKey,"musicTrack"),2);case 2:M=Z.B;if(!M){v=void 0;Z.G$(3);break}return g.m(Z,Cy(R.B,M.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:v=Z.B;case 3:I=v;if(!M||!I)return Z.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));E=g.t(F.actionMetadata,Ri6);g.Hi(Z,5);return g.m(Z,Fw6(R,J,I.addedTimestampMillis,(B=E)==null?void 0:B.track,(r=E)==null?void 0:r.albumRelease),
7);case 7:p=Number(((Y=F.actionMetadata)==null?void 0:Y.priority)||0)+1;w=b$("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",J,"playbackData",p,hi7);g.yn(Z,6);break;case 5:k=g.f_(Z);if(!(k instanceof Error&&k.message==="No data")){if(k instanceof Error&&k.message==="Empty response body")an(k.message);else return H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.EU&&k.type==="QUOTA_EXCEEDED"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Z.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,H,T));Z.G$(6);break}return g.m(Z,LN(J,R.B,F,R.K),6);case 6:return Z.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,w?[w]:void 0))}})},Mmu=function(R,F){var h,a;
return g.u(function(J){switch(J.D){case 1:return h=In(F),g.Hi(J,2),a=g.lp(F.entityKey).entityId,a==="!*$_ALL_ENTITIES_!*$"?g.m(J,yy(R.B,F,R.K),5):g.m(J,LN(a,R.B,F,R.K),6);case 6:return g.m(J,Tz7(R.B,F.entityKey),5);case 5:g.yn(J,3);break;case 2:return g.f_(J),J.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return J.return(new SK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},Fw6=function(R,F,h,a,J){var M,v,I,w,E,B;
return g.u(function(r){switch(r.D){case 1:if(M=a){r.G$(2);break}return g.m(r,jj9([F]),3);case 3:v=r.B,I=v[0],M=HV9(I);case 2:return g.m(r,v64(R,M,F,J,h),4);case 4:w=r.B;E=w.musicTrackEntity;B=w.YU;var Y=sh(E.thumbnailDetails),p=[];B&&(p=sh(B.thumbnailDetails));return g.m(r,AK(Y.concat(p)),0)}})},v64=function(R,F,h,a,J){var M;
return g.u(function(v){return v.D==1?(J||(J=Date.now().toString()),M={id:g.DI(h,"musicTrackDownloadMetadataEntity"),playbackData:g.DI(h,"playbackData"),addedTimestampMillis:J,videoDownloadContextEntity:g.DI(h,"videoDownloadContextEntity")},a&&(F.albumRelease=a.id),g.m(v,VR(R.B,{mode:"readwrite",qt:!0},function(I){var w=[],E=Ky(I,M,"musicTrackDownloadMetadataEntity");w.push(E);E=Ky(I,F,"musicTrack");w.push(E);a&&(I=Ky(I,a,"musicAlbumRelease"),w.push(I));return g.Qe.all(w)}),2)):v.D!=3?g.m(v,B0(h,"musicTrackDownloadMetadataEntity",
R.B,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):v.return({musicTrackEntity:F,
YU:a})})},W0=function(){l$.apply(this,arguments);
this.C="musicTrack"},g66=function(R,F,h){F=F===void 0?43200:F;
h=h===void 0?!0:h;var a=a===void 0?!1:a;var J,M;return g.u(function(v){switch(v.D){case 1:if(!R.S.sT())return v.return([]);J=[];g.Hi(v,2);return g.m(v,XYk(F,h,a),4);case 4:J=v.B;g.yn(v,3);break;case 2:g.f_(v);case 3:return M=BA6(R,J,h,"musicPlaylist"),v.return(M)}})},Guh=function(){g.Hb.apply(this,arguments);
var R=this;this.events=new g.xK(this);this.uu=this.player.W();this.rf={asG:function(){return R.B},
ZK:function(){return R.ZK()},
EM:function(F){return R.EM(F)}}},IP7=function(R){var F;
R=g.t((F=R.getWatchNextResponse())==null?void 0:F.currentVideoEndpoint,g.EG);if(R==null?0:R.playlistId)var h=R.playlistId;return h},ip7=function(R,F){var h,a,J,M;
return g.u(function(v){if(v.D==1){h=F.clientPlaybackNonce;a={cpn:h,offlineSourceVisualElement:g.sD(F.Sl||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};F.D&&(a.videoFmt=Number(F.D.itag));F.L&&(a.audioFmt=Number(F.L.itag));if((J=IP7(F))&&F.videoId){var I=F.videoId;I=J!=="PPSV"?Promise.resolve(!1):R.B.OF(I);v=g.m(v,I,3)}else v=v.G$(2);return v}v.D!=2&&(M=v.B)&&(a.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");R.D=h;g.MU("offlinePlaybackStarted",a);g.Na(v)})};
g.O4.prototype.r7=g.Ma(45,function(R){return this.app.r7(R)});
g.Ae.prototype.r7=g.Ma(44,function(R){return g.xPL(this,9,R)});
g.A(o5,mC);g.i7.Object.defineProperties(o5.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.B.entityMetadata},
set:function(R){this.B.entityMetadata=R}}});
g.A(REG,o5);REG.prototype.D=function(){return[]};
g.A(Fh4,o5);Fh4.prototype.D=function(){return[]};
g.A(hE4,o5);hE4.prototype.D=function(){return[]};
g.A(aM6,o5);aM6.prototype.D=function(){return[]};
g.A(JN9,o5);JN9.prototype.D=function(){var R=[];this.B.alternateChannel&&R.push(this.B.alternateChannel);this.B.alternateChannelList&&R.push.apply(R,g.S(this.B.alternateChannelList));this.B.oneofChannelEntity&&R.push(this.B.oneofChannelEntity);return[].concat(g.S(new Set(R)))};
g.A(Mpu,o5);Mpu.prototype.D=function(){var R=[];this.B.entryCollection&&R.push(this.B.entryCollection);return[].concat(g.S(new Set(R)))};
g.A(vXL,mC);vXL.prototype.D=function(){var R=[];this.B.video&&R.push(this.B.video);return[].concat(g.S(new Set(R)))};
g.A(gX6,o5);gX6.prototype.D=function(){var R=[];this.B.parentPlaylist&&R.push(this.B.parentPlaylist);if(this.B.entries)for(var F=g.N(this.B.entries),h=F.next();!h.done;h=F.next())R.push.apply(R,g.S((new vXL(h.value)).D()));return[].concat(g.S(new Set(R)))};
g.A(GBe,o5);GBe.prototype.D=function(){var R=[];this.B.descriptionEntity&&R.push(this.B.descriptionEntity);this.B.creators&&R.push.apply(R,g.S(this.B.creators));this.B.theBiggestFan&&R.push(this.B.theBiggestFan);return[].concat(g.S(new Set(R)))};
g.A(IM7,o5);IM7.prototype.D=function(){return[]};
g.A(ii9,o5);ii9.prototype.D=function(){return[]};
g.A(wB9,o5);wB9.prototype.D=function(){return[]};
g.A(EXk,o5);EXk.prototype.D=function(){return[]};
g.A(BTg,o5);BTg.prototype.D=function(){return[]};
g.A(rN9,o5);rN9.prototype.D=function(){return[]};
g.A(Y_7,o5);Y_7.prototype.D=function(){return[]};
g.A(shh,o5);shh.prototype.D=function(){return[]};
g.A(pB9,o5);pB9.prototype.D=function(){return[]};
g.A(kBk,o5);kBk.prototype.D=function(){var R=[];this.B.downloadsList&&R.push(this.B.downloadsList);this.B.smartDownloadsList&&R.push(this.B.smartDownloadsList);this.B.recommendedDownloadsList&&R.push(this.B.recommendedDownloadsList);this.B.refresh&&R.push(this.B.refresh);return[].concat(g.S(new Set(R)))};
g.A(Qhv,mC);Qhv.prototype.D=function(){var R=[];this.B.video&&R.push(this.B.video);this.B.playlist&&R.push(this.B.playlist);this.B.videoItem&&R.push(this.B.videoItem);this.B.playlistItem&&R.push(this.B.playlistItem);return[].concat(g.S(new Set(R)))};
g.A($p9,o5);$p9.prototype.D=function(){var R=[];this.B.refresh&&R.push(this.B.refresh);if(this.B.downloads)for(var F=g.N(this.B.downloads),h=F.next();!h.done;h=F.next())R.push.apply(R,g.S((new Qhv(h.value)).D()));return[].concat(g.S(new Set(R)))};
g.A(ANu,o5);ANu.prototype.D=function(){var R=[];this.B.localImageEntities&&R.push.apply(R,g.S(this.B.localImageEntities));return[].concat(g.S(new Set(R)))};
g.A(xpv,o5);xpv.prototype.D=function(){var R=[];this.B.playbackData&&R.push(this.B.playbackData);this.B.localImageEntities&&R.push.apply(R,g.S(this.B.localImageEntities));this.B.videoDownloadContextEntity&&R.push(this.B.videoDownloadContextEntity);return[].concat(g.S(new Set(R)))};
g.A(NTg,o5);NTg.prototype.D=function(){return[]};
g.A(Hiv,o5);Hiv.prototype.D=function(){var R=[];this.B.fakeChildren&&R.push.apply(R,g.S(this.B.fakeChildren));return[].concat(g.S(new Set(R)))};
g.A(Lhg,o5);Lhg.prototype.D=function(){var R=[];this.B.video&&R.push(this.B.video);this.B.playbackData&&R.push(this.B.playbackData);this.B.offlineVideoPolicy&&R.push(this.B.offlineVideoPolicy);return[].concat(g.S(new Set(R)))};
g.A(TT7,o5);TT7.prototype.D=function(){return[]};
g.A(yN6,o5);yN6.prototype.D=function(){var R=[];this.B.channelOwner&&R.push(this.B.channelOwner);this.B.videos&&R.push.apply(R,g.S(this.B.videos));this.B.collaboratorChannels&&R.push.apply(R,g.S(this.B.collaboratorChannels));this.B.downloadState&&R.push(this.B.downloadState);this.B.refresh&&R.push(this.B.refresh);return[].concat(g.S(new Set(R)))};
g.A(q_7,o5);q_7.prototype.D=function(){var R=[];this.B.video&&R.push(this.B.video);this.B.channelContributor&&R.push(this.B.channelContributor);return[].concat(g.S(new Set(R)))};
g.A(fMt,mC);fMt.prototype.D=function(){var R=[];this.B.localImageEntities&&R.push.apply(R,g.S(this.B.localImageEntities));this.B.videoDownloadContextEntity&&R.push(this.B.videoDownloadContextEntity);return[].concat(g.S(new Set(R)))};
g.A(jhU,mC);jhU.prototype.D=function(){var R=[];this.B.recommendedVideoMetadata&&R.push.apply(R,g.S((new fMt(this.B.recommendedVideoMetadata)).D()));return[].concat(g.S(new Set(R)))};
g.A(Zi9,mC);Zi9.prototype.D=function(){var R=[];this.B.playbackPosition&&R.push(this.B.playbackPosition);return[].concat(g.S(new Set(R)))};
g.A(bi6,o5);bi6.prototype.D=function(){var R=[];this.B.owner&&R.push(this.B.owner);this.B.downloadState&&R.push(this.B.downloadState);this.B.userState&&R.push.apply(R,g.S((new Zi9(this.B.userState)).D()));this.B.additionalMetadata&&R.push.apply(R,g.S((new jhU(this.B.additionalMetadata)).D()));return[].concat(g.S(new Set(R)))};
g.A(S_h,o5);S_h.prototype.D=function(){var R=[];this.B.userChannelDetails&&R.push(this.B.userChannelDetails);return[].concat(g.S(new Set(R)))};
g.A(Oi9,o5);Oi9.prototype.D=function(){var R=[];this.B.channelOwner&&R.push(this.B.channelOwner);this.B.playbackPosition&&R.push(this.B.playbackPosition);this.B.localImageEntities&&R.push.apply(R,g.S(this.B.localImageEntities));this.B.downloadStatus&&R.push(this.B.downloadStatus);return[].concat(g.S(new Set(R)))};
g.A(mpL,o5);mpL.prototype.D=function(){return[]};
g.A(oXk,o5);oXk.prototype.D=function(){return[]};
g.A(XBv,o5);XBv.prototype.D=function(){return[]};
g.A(eE4,o5);eE4.prototype.D=function(){return[]};
g.A(nXu,o5);nXu.prototype.D=function(){return[]};
g.A(uz9,o5);uz9.prototype.D=function(){return[]};
g.A(dpL,o5);dpL.prototype.D=function(){return[]};
g.A(PEg,o5);PEg.prototype.D=function(){return[]};
g.A(zEe,o5);zEe.prototype.D=function(){return[]};
g.A(Kh7,o5);Kh7.prototype.D=function(){return[]};
g.A(tpe,o5);tpe.prototype.D=function(){return[]};
g.A(lM6,o5);lM6.prototype.D=function(){return[]};
g.A(Dpe,o5);Dpe.prototype.D=function(){var R=[];this.B.trackDownloadMetadatas&&R.push.apply(R,g.S(this.B.trackDownloadMetadatas));return[].concat(g.S(new Set(R)))};
g.A(Vpu,o5);
Vpu.prototype.D=function(){var R=[];this.B.downloadedTracks&&R.push.apply(R,g.S(this.B.downloadedTracks));this.B.smartDownloadedTracks&&R.push.apply(R,g.S(this.B.smartDownloadedTracks));this.B.downloadedEpisodes&&R.push.apply(R,g.S(this.B.downloadedEpisodes));this.B.downloadedAlbumReleases&&R.push.apply(R,g.S(this.B.downloadedAlbumReleases));this.B.smartDownloadedAlbumReleases&&R.push.apply(R,g.S(this.B.smartDownloadedAlbumReleases));this.B.downloadedPlaylists&&R.push.apply(R,g.S(this.B.downloadedPlaylists));this.B.smartDownloadedPlaylists&&
R.push.apply(R,g.S(this.B.smartDownloadedPlaylists));this.B.metadataOnlyTracks&&R.push.apply(R,g.S(this.B.metadataOnlyTracks));return[].concat(g.S(new Set(R)))};
g.A(Uph,o5);Uph.prototype.D=function(){var R=[];this.B.trackDownloadMetadatas&&R.push.apply(R,g.S(this.B.trackDownloadMetadatas));return[].concat(g.S(new Set(R)))};
g.A(CEU,o5);CEU.prototype.D=function(){var R=[];this.B.playbackData&&R.push(this.B.playbackData);this.B.localImageEntities&&R.push.apply(R,g.S(this.B.localImageEntities));this.B.videoDownloadContextEntity&&R.push(this.B.videoDownloadContextEntity);return[].concat(g.S(new Set(R)))};
g.A(cNe,o5);cNe.prototype.D=function(){var R=[];this.B.musicLibraryStatusEntity&&R.push(this.B.musicLibraryStatusEntity);this.B.primaryArtists&&R.push.apply(R,g.S(this.B.primaryArtists));this.B.details&&R.push(this.B.details);this.B.userDetails&&R.push(this.B.userDetails);this.B.tracks&&R.push.apply(R,g.S(this.B.tracks));this.B.share&&R.push(this.B.share);this.B.downloadMetadata&&R.push(this.B.downloadMetadata);this.B.refresh&&R.push(this.B.refresh);return[].concat(g.S(new Set(R)))};
g.A(Whh,o5);Whh.prototype.D=function(){var R=[];this.B.albumRelease&&R.push(this.B.albumRelease);this.B.tracks&&R.push.apply(R,g.S(this.B.tracks));return[].concat(g.S(new Set(R)))};
g.A(Rek,o5);Rek.prototype.D=function(){var R=[];this.B.albumRelease&&R.push(this.B.albumRelease);return[].concat(g.S(new Set(R)))};
g.A(Fz7,o5);Fz7.prototype.D=function(){var R=[];this.B.details&&R.push(this.B.details);this.B.userDetails&&R.push(this.B.userDetails);return[].concat(g.S(new Set(R)))};
g.A(heu,o5);heu.prototype.D=function(){var R=[];this.B.parentArtist&&R.push(this.B.parentArtist);return[].concat(g.S(new Set(R)))};
g.A(aR4,o5);aR4.prototype.D=function(){var R=[];this.B.parentArtist&&R.push(this.B.parentArtist);return[].concat(g.S(new Set(R)))};
g.A(JVv,o5);JVv.prototype.D=function(){return[]};
g.A(MRg,o5);MRg.prototype.D=function(){return[]};
g.A(vAL,mC);vAL.prototype.D=function(){var R=[];this.B.creatorEntity&&R.push(this.B.creatorEntity);return[].concat(g.S(new Set(R)))};
g.A(gA4,o5);
gA4.prototype.D=function(){var R=[];this.B.tracks&&R.push.apply(R,g.S(this.B.tracks));this.B.refresh&&R.push(this.B.refresh);this.B.musicLibraryStatusEntity&&R.push(this.B.musicLibraryStatusEntity);this.B.details&&R.push(this.B.details);this.B.downloadMetadata&&R.push(this.B.downloadMetadata);this.B.sideloadMetadata&&R.push(this.B.sideloadMetadata);this.B.userDetails&&R.push(this.B.userDetails);this.B.entryCollection&&R.push(this.B.entryCollection);this.B.share&&R.push(this.B.share);this.B.podcastShowAdditionalMetadata&&R.push.apply(R,
g.S((new vAL(this.B.podcastShowAdditionalMetadata)).D()));return[].concat(g.S(new Set(R)))};
g.A(Gdh,o5);Gdh.prototype.D=function(){return[]};
g.A(IRt,o5);
IRt.prototype.D=function(){var R=[];this.B.musicLibraryStatusEntity&&R.push(this.B.musicLibraryStatusEntity);this.B.artists&&R.push.apply(R,g.S(this.B.artists));this.B.audioModeVersion&&R.push(this.B.audioModeVersion);this.B.videoModeVersion&&R.push(this.B.videoModeVersion);this.B.userDetails&&R.push(this.B.userDetails);this.B.details&&R.push(this.B.details);this.B.albumRelease&&R.push(this.B.albumRelease);this.B.share&&R.push(this.B.share);this.B.libraryEdit&&R.push(this.B.libraryEdit);this.B.downloadMetadata&&
R.push(this.B.downloadMetadata);this.B.playbackPosition&&R.push(this.B.playbackPosition);this.B.lyrics&&R.push(this.B.lyrics);return[].concat(g.S(new Set(R)))};
g.A(iue,o5);iue.prototype.D=function(){var R=[];this.B.parentTrack&&R.push(this.B.parentTrack);return[].concat(g.S(new Set(R)))};
g.A(wpt,o5);wpt.prototype.D=function(){var R=[];this.B.parentTrack&&R.push(this.B.parentTrack);return[].concat(g.S(new Set(R)))};
g.A(EAu,o5);EAu.prototype.D=function(){return[]};
g.A(BFg,o5);BFg.prototype.D=function(){return[]};
g.A(rVv,o5);rVv.prototype.D=function(){return[]};
g.A(Yt7,o5);Yt7.prototype.D=function(){return[]};
g.A(sx7,o5);sx7.prototype.D=function(){var R=[];this.B.transfer&&R.push(this.B.transfer);this.B.adsPlaybackData&&R.push.apply(R,g.S(this.B.adsPlaybackData));this.B.drmLicense&&R.push(this.B.drmLicense);this.B.offlineVideoPolicy&&R.push(this.B.offlineVideoPolicy);this.B.videoDownloadContextEntity&&R.push(this.B.videoDownloadContextEntity);return[].concat(g.S(new Set(R)))};
g.A(pp4,o5);pp4.prototype.D=function(){return[]};
g.A(kd6,o5);kd6.prototype.D=function(){var R=[];this.B.offlineVideoStreams&&R.push.apply(R,g.S(this.B.offlineVideoStreams));this.B.captionTrack&&R.push.apply(R,g.S(this.B.captionTrack));return[].concat(g.S(new Set(R)))};
g.A(QxU,o5);QxU.prototype.D=function(){return[]};
g.A($Te,o5);$Te.prototype.D=function(){return[]};
g.A(AVe,o5);AVe.prototype.D=function(){return[]};
g.A(xT7,o5);xT7.prototype.D=function(){return[]};
g.A(NF6,o5);NF6.prototype.D=function(){return[]};
g.A(Hue,o5);Hue.prototype.D=function(){return[]};
g.A(Lz4,o5);Lz4.prototype.D=function(){return[]};
g.A(TF7,o5);TF7.prototype.D=function(){return[]};
g.A(yVg,o5);yVg.prototype.D=function(){return[]};
g.A(qte,o5);qte.prototype.D=function(){return[]};
g.A(fR7,o5);fR7.prototype.D=function(){return[]};
g.A(jx4,o5);jx4.prototype.D=function(){return[]};
g.A(Zug,o5);Zug.prototype.D=function(){return[]};
g.A(buL,o5);buL.prototype.D=function(){return[]};
g.A(StU,o5);StU.prototype.D=function(){return[]};
g.A(Ou7,o5);Ou7.prototype.D=function(){return[]};
g.A(mTu,o5);mTu.prototype.D=function(){return[]};
g.A(oAg,o5);oAg.prototype.D=function(){return[]};
g.A(Xpk,o5);Xpk.prototype.D=function(){return[]};
g.A(eeu,o5);eeu.prototype.D=function(){return[]};
g.A(nA9,o5);nA9.prototype.D=function(){return[]};
var evg=["browse","music/browse","unplugged/browse"],zv7=["offline/playlist_sync_check"],f_9=["offline"],nyv=["offline/offline_video_playback_position_sync"],dKe=["offline/get_playback_data_entity"],X9;es.getInstance=function(){return g.u(function(R){return R.return(new Promise(function(F){g.Dd().then(function(h){h?(es.instance||(es.instance=new es(h)),F(es.instance)):F(void 0)})}))})};
es.prototype.get=function(R){var F=this,h,a,J;return g.u(function(M){if(M.D==1)return g.m(M,ze9(F.token),2);if(M.D!=3)return h=M.B,g.m(M,h.get("prefs",R),3);a=M.B;if(!a)return M.return();J=(0,g.NU)();return a.expirationTimestampMs<=J?M.return():M.return(a.value)})};
es.prototype.set=function(R,F,h){h=h===void 0?31536E3:h;var a=this,J,M,v;return g.u(function(I){if(I.D==1)return J=(0,g.NU)(),M={key:R,value:F,expirationTimestampMs:J+h*1E3},g.m(I,ze9(a.token),2);v=I.B;return g.m(I,g.fm(v,"prefs",M),0)})};
es.prototype.remove=function(R){var F=this,h;return g.u(function(a){if(a.D==1)return g.m(a,ze9(F.token),2);h=a.B;return g.m(a,h.delete("prefs",R),0)})};
g.A(ny,g.Pv);g.A(uP,VRL);uP.prototype.K=function(R,F){F=CL4(F);R=(new TextEncoder).encode(JSON.stringify(R));return this.B.encrypt(R,F)};
uP.prototype.D=function(R,F){if(!(R instanceof Uint8Array))throw Kzu(1);var h=new TextDecoder;F=CL4(F);R=this.B.decrypt(R,F);return JSON.parse(h.decode(R))};
var cV7={accountLinkStatusEntity:wB9,booleanEntity:hE4,buttonEntity:buL,captionTrack:EAu,channelHandle:REG,chipEntity:Lz4,commerceAcquisitionClientPayloadEntity:Ou7,commerceCartListEntity:mTu,contextNoteFeedEntityPayload:Fh4,continuationTokenEntity:TT7,downloadQualityPickerEntity:Y_7,downloadsPageRefreshTokenEntity:pB9,downloadsPageViewConfigurationEntity:mpL,downloadStatusEntity:shh,dismissState:TF7,sfvAudioItemCurrentlyPlayingEntity:xT7,emojiFountainDataEntity:jx4,emojiCustomizationSetEntity:fR7,
fakeChannel:JN9,fakePlaylist:Mpu,fakePlaylistEntryCollection:gX6,fakeVideo:GBe,fakeVideoDescription:IM7,featuredProductsEntity:Kh7,flowStateEntity:ii9,iconBadgeEntity:oAg,interstitialInteractionStateEntity:BTg,likeButtonAnimationEntity:oXk,liveChatPollStateEntity:rN9,liveViewerLeaderboardChatEntryPointStateEntity:$Te,liveViewerLeaderboardPointsEntity:AVe,liveReactionsDataEntity:Zug,logoEntity:EXk,macroMarkerEntity:XBv,mainDownloadsLibraryEntity:kBk,mainDownloadsListEntity:$p9,mainPlaylistDownloadStateEntity:ANu,
mainPlaylistEntity:yN6,mainPlaylistVideoEntity:q_7,mainVideoDownloadStateEntity:xpv,mainVideoEntity:bi6,markersEngagementPanelSyncEntity:eE4,markersVisibilityOverrideEntity:nXu,musicAlbumReleaseDetail:Whh,musicAlbumReleaseDownloadMetadataEntity:Dpe,musicAlbumRelease:cNe,musicAlbumReleaseUserDetail:Rek,musicArtistDetail:heu,musicArtist:Fz7,musicArtistUserDetail:aR4,musicDownloadsLibraryEntity:Vpu,musicLibraryEdit:JVv,musicLibraryStatusEntity:MRg,musicPlaylist:gA4,musicPlaylistDownloadMetadataEntity:Uph,
musicShare:Gdh,musicTrackDetail:iue,musicTrackDownloadMetadataEntity:CEU,musicTrack:IRt,musicTrackUserDetail:wpt,offlineOrchestrationActionWrapperEntity:BFg,offlineVideoPolicy:rVv,offlineVideoStreams:Yt7,offlineabilityEntity:NTg,orchestrationWebSamplingEntity:Hiv,pageHeaderEntity:yVg,pdpStateEntity:Xpk,pinnedProductEntity:tpe,playbackData:sx7,playerStateEntity:uz9,quantityIncrementerEntity:eeu,refresh:pp4,saveToPlaylistListEntity:NF6,selectedChipIndexEntityPayload:dpL,settingEntity:Hue,stringEntity:aM6,
suggestedFeedbackChipStateEntity:PEg,transfer:kd6,trendingOfferEntity:lM6,videoDownloadContextEntity:QxU,videoOverviewAsyncDataEntity:nA9,videoPlaybackPositionEntity:StU,votingEntity:qte,ytMainChannelEntity:S_h,youchatPendingResponseEntity:zEe,ytMainDownloadedVideoEntity:Lhg,ytMainVideoEntity:Oi9};g.A(lP,VRL);lP.prototype.K=function(R){return R};
lP.prototype.D=function(R){if(R instanceof Uint8Array)throw Kzu(0);return R};
g.A(De,g.d);De.prototype.observe=function(R){var F=this;this.observers.push(R);return function(){var h=F.observers.indexOf(R);h>=0&&F.observers.splice(h,1)}};
De.prototype.D=function(R){Eag(this,R.data)};
De.prototype.Ez=function(){this.channel.close()};
var pLL,YJe=new g.Ng("elementsCommand");var NB=new g.Ng("entityBatchUpdate");var a_L=new g.Ng("downloadStatusEntity");var Qp6=new g.Ng("mainPlaylistEntityActionMetadata");var Uh=new g.Ng("mainVideoEntityActionMetadata");var qJ7=new g.Ng("musicPlaylistEntityActionMetadata");var Ri6=new g.Ng("musicTrackEntityActionMetadata");var OWg=new g.Ng("localImageEntityActionMetadata");var Oh=new g.Ng("playbackDataActionMetadata");var s3g=new g.Ng("transferEntityActionMetadata");var Fdh=new g.Ng("videoPlaybackPositionEntityActionMetadata");var bJL;new g.EJ;new g.EJ;XL4.prototype.request=function(R,F,h){F=F===void 0?{}:F;return this.locks.request(R,F,function(a){return h(a)})};var hK=g.Wi.caches,Fb,PeU;Rn.prototype.open=function(R){return hK.open(uNe(R))};
Rn.prototype.has=function(R){return hK.has(uNe(R))};
Rn.prototype.delete=function(R){return hK.delete(uNe(R))};
Rn.prototype.match=function(R,F){var h=this,a,J,M,v,I,w;return g.u(function(E){switch(E.D){case 1:return g.m(E,h.keys(),2);case 2:a=E.B,J=g.N(a),M=J.next();case 3:if(M.done){E.G$(5);break}v=M.value;return g.m(E,h.open(v),6);case 6:return I=E.B,g.m(E,I.match(R,F),7);case 7:if(w=E.B)return E.return(w);M=J.next();E.G$(3);break;case 5:return E.return()}})};
g.A(naL,Rn);naL.prototype.keys=function(){var R,F,h,a,J,M,v,I,w;return g.u(function(E){if(E.D==1)return R=[],F=g.zP("CacheStorage keys"),g.m(E,hK.keys(),2);h=E.B;a=g.N(h);for(J=a.next();!J.done;J=a.next()){M=J.value;var B=M.indexOf(":");v=B===-1?{Q8:M}:{Q8:M.substring(0,B),datasyncId:M.substring(B+1)};I=v.Q8;w=v.datasyncId;w===F&&R.push(I)}return E.return(R)})};g.A(JK,g.d);JK.prototype.K=function(R){this.api.WG("onOfflineOperationFailure",R.data)};
JK.prototype.L=function(R){this.api.publish("offlinetransferpause",R.data)};
JK.prototype.Ez=function(){var R;(R=this.B)==null||R.close();var F;(F=this.D)==null||F.close()};tVU.prototype.u0=function(){this.B&&v0(this)};
tVU.prototype.MR=function(){this.D&&this.D.resolve();this.K=this.B=!1;this.C()};var bDu=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var Ey7="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var Nz7="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.A(tkt,Zc);tkt.prototype.D=function(R){return i$(R)?Vkv(this,R):wx(R)?c1u(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};g.A(WW7,Zc);WW7.prototype.D=function(R){return wx(R)?RG6(this,R):hv7(R)?hGv(this,R):Eh(R)?aY9(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};g.Q=Jj7.prototype;g.Q.QRb=function(R){var F=this,h,a,J,M;return g.u(function(v){if(!g.V(R.state,128))return v.G$(0);h=R.state.wL;var I=(a=h)==null?void 0:a.errorCode,w=(J=h)==null?void 0:J.N9;M=I==="net.connect"&&w===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(I==null?0:I.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.m(v,F.q_(F.player.getVideoData().videoId,M),0)})};
g.Q.q_=function(R,F){var h=this;return g.u(function(a){if(a.D==1){if(h.D)return a.return();h.D=!0;return F==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(eK(h,R,!1,!0),a.G$(0)):g.m(a,Xb(h,R),3)}g.tJ(R,4);return g.m(a,h.B.q_(F),0)})};
g.Q.Iv=function(R){R.status===2?(R.status!==this.K&&(R76(this.B),g.tJ(R.videoId,2)),R.ud&&MM7(this.B,R.videoId,R.ud)):R.status===4?(Xb(this,R.videoId),this.q_(R.videoId,R.MD?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):R.status===1&&J$6(this.B);this.K=R.status;this.api.WG("localmediachange",{videoId:R.videoId,status:R.status})};
g.Q.xB=function(){var R=this,F;return g.u(function(h){if(h.D==1){if(R.D)return h.return();R.D=!0;F=R.player.getVideoData().videoId;return g.m(h,Xb(R,F),2)}return g.m(h,R.B.xB(),0)})};
g.Q.kh=function(R){switch(R){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.Q.X=function(R){return this.api.W().X(R)};g.A(w9L,Zc);w9L.prototype.D=function(R){return i$(R)?BIL(this,R):wx(R)?rjL(this,R):hv7(R)?YXU(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};AjU.prototype.B=function(R,F){var h=R.action.actionMetadata.priority-F.action.actionMetadata.priority;h===0&&(R.B<F.B?h=-1:R.B>F.B&&(h=1));return h};g.A(nN,g.d);nN.prototype.Ez=function(){this.C&&this.C();g.d.prototype.Ez.call(this)};
nN.prototype.createAction=function(R,F){var h=g.lp(R.entityKey).entityType,a=g.sY(16);return new pN(h,a,R,F.actionId,F.rootActionId)};
nN.prototype.aR=function(R){var F=this,h,a,J,M,v,I,w,E,B;return g.u(function(r){if(r.D==1){if(F.RR())return r.return();a=(h=R.offlineOrchestrationActionWrapperEntity)!=null?h:new Set;J=[];M=g.N(a);for(v=M.next();!v.done;v=M.next())I=v.value,w=g.lp(I),E=w.entityId,HDk(F.B,E)||J.push(I);return g.m(r,mnk(F,J),2)}B=r.B;return g.m(r,OD9(F,B),0)})};
nN.prototype.retry=function(){var R=this;return g.u(function(F){return g.m(F,oYU(R),0)})};eG9.prototype.P_=function(R,F){F=F===void 0?!0:F;var h=this,a,J,M,v,I,w,E,B;return g.u(function(r){switch(r.D){case 1:if(!h.B)return r.return();a=[];J=g.MO(h.B.D,F);M=[];for(v={FL:0};v.FL<J.length;v={FL:v.FL},v.FL++)I=J[v.FL],w=h.B.gj(I,"json3"),E=g.T6(w,{withCredentials:!0,format:"RAW"},3,500).then(function(Y){return function(p){p={metadata:g.jQ(J[Y.FL]),trackData:p.xhr.responseText};M.push(p)}}(v)).eK(function(Y){an("Caption fetch error",Y)}),a.push(E);
return g.m(r,Wt7(a),2);case 2:return g.Hi(r,3),g.m(r,L7G(R,M),5);case 5:g.yn(r,0);break;case 3:B=g.f_(r),an("Caption DB transaction error",B),g.Na(r)}})};g.A(u$,g.d);u$.prototype.Ez=function(){this.D&&this.D();g.d.prototype.Ez.call(this)};
u$.prototype.K=function(R){var F=this,h,a,J,M,v,I,w,E;return g.u(function(B){a=(h=R.transfer)!=null?h:new Set;J=[];M=g.N(a);for(v=M.next();!v.done;v=M.next())I=v.value,w=g.lp(I),E=w.entityId,J.push(E);return J.length===0?B.return():g.m(B,dn4(F,J),0)})};g.A(lYk,g.d);g.Q=lYk.prototype;g.Q.Ez=function(){this.KI&&this.KI();this.Uz.dispose();this.L.dispose();this.Sl&&g.Cu(this.S.LX,this.Sl);this.Oz&&g.Cu(this.S.LX,this.Oz);g.d.prototype.Ez.call(this)};
g.Q.qfI=function(R){var F=this,h,a,J;return g.u(function(M){switch(M.D){case 1:h=g.DI(R,"transfer");if(F.B&&h===F.B.key){eK(F.Y,F.N,!0);F.L.stop();M.G$(0);break}return g.m(M,VR(F.D,{mode:"readwrite",qt:!0},function(v){return dN(v,h,"transfer").then(function(I){if(I&&I.transferState!=="TRANSFER_STATE_COMPLETE"&&I.transferState!=="TRANSFER_STATE_FAILED")return I.transferState="TRANSFER_STATE_PAUSED_BY_USER",Ky(v,I,"transfer").then(function(){return I})})}),3);
case 3:a=M.B;if(!a){M.G$(0);break}if(!R||!F.K){M.G$(5);break}return g.m(M,B0(R,F.K,F.D,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.m(M,zO(F,R),7);case 7:J=M.B,Rvh({videoId:R,jy:a,offlineModeType:J}),g.Na(M)}})};
g.Q.MIu=function(){var R=this;if(this.B&&this.N){eK(this.Y,this.N,!1);var F=this.B,h=(F==null?0:F.key)?g.lp(F.key).entityId:"";h&&this.K&&(new Promise(function(a,J){B0(h,R.K,R.D,"DOWNLOAD_STATE_PAUSED").catch(function(M){J(M)})})).catch(function(a){an("Download state setting error",a)})}this.L.stop()};
g.Q.qr=function(){this.B?Unk(this,this.B):P0(this)};
g.Q.fE=function(R){var F=this;return g.u(function(h){switch(h.D){case 1:if(!F.B){h.G$(2);break}if(F.B.transferState==="TRANSFER_STATE_COMPLETE"||F.B.transferState==="TRANSFER_STATE_FAILED"||!R.transfer||!R.transfer.has(F.B.key)){h.G$(3);break}return g.m(h,Cy(F.D,F.B.key,"transfer"),4);case 4:F.B=h.B;if(F.B){h.G$(3);break}return g.m(h,CGe(F),3);case 3:if(F.B)return h.return();case 2:return g.m(h,P0(F),0)}})};
g.Q.q_=function(R,F){var h=this,a,J,M,v,I;return g.u(function(w){switch(w.D){case 1:if(!h.B){KN(h,"onTransferFailure: "+R);w.G$(2);break}a=h.B;M=((J=a)==null?0:J.key)?g.lp(a.key).entityId:"";a:switch(R){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var E=!1;break a;default:E=!0}return E&&vUt(h)?g.m(w,tK(h,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.m(w,
gU7(h,R),5);case 5:if(!M||!h.K){w.G$(2);break}return g.m(w,B0(M,h.K,h.D,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.m(w,zO(h,M),9);case 9:v=w.B;GO({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:M,jy:a,offlineModeType:v});if(!M||!h.K){w.G$(2);break}return g.m(w,B0(M,h.K,h.D,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:dx(h),I=P0(h,!0),F&&F(I),g.Na(w)}})};
g.Q.xB=function(R){var F=this,h,a,J,M,v,I,w,E,B,r,Y,p;return g.u(function(k){switch(k.D){case 1:if(!F.B){KN(F,"onMaybeTransferStreamsExpired");k.G$(2);break}return vUt(F)?g.m(k,tK(F,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.m(k,gU7(F,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!F.K){k.G$(2);break}h=F.B;J=((a=h)==null?0:a.key)?g.lp(h.key).entityId:"";if(!J){k.G$(2);break}return g.m(k,B0(J,F.K,F.D,"DOWNLOAD_STATE_FAILED"),2);case 9:return F.B||KN(F,"onMaybeTransferStreamsExpiredRetryAttempting"),
M=F.B,I=((v=M)==null?0:v.key)?g.lp(M.key).entityId:"",g.m(k,zO(F,I),10);case 10:return w=k.B,GO({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:I,jy:M,offlineModeType:w}),E=vyU(),g.S2(E,Oh,{isEnqueuedForExpiredStreamUrlRefetch:!0}),B=g.DI(I,"playbackData"),r={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:B,actionMetadata:E},Y=Qy(new pN("playbackData",I,r)),g.m(k,U9(F.D,Y,"offlineOrchestrationActionWrapperEntity"),2);case 2:dx(F),p=P0(F,!0),
R&&R(p),g.Na(k)}})};
var wkg={},GiU=(wkg.TRANSFER_STATE_TRANSFERRING=1,wkg.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,wkg);g.Q=l$.prototype;g.Q.J9=function(){return this.N.promise};
g.Q.a6=function(){if(this.D&&this.Y)return this.N.promise;wsG(this).then(this.N.resolve).catch(this.N.reject);return this.N.promise};
g.Q.HP=function(R){var F={};return F.playbackData=new tkt(R,this.uu,this.B),F.transfer=new w9L(R,this.uu),F.videoPlaybackPositionEntity=new WW7(R,this.uu),F};
g.Q.Uq=function(){var R=this;return g.u(function(F){return R.D?g.m(F,DnU(R.D),0):F.G$(0)})};
g.Q.E8=function(){var R=this,F,h;return g.u(function(a){if(a.D==1)return R.D||R.Y?g.m(a,R.J9(),2):a.return();R.Z!==void 0&&(g.Y$(R.Z),R.Z=void 0);R.L!==void 0&&(g.Y$(R.L),R.L=void 0);(F=R.D)==null||F.dispose();R.D=void 0;(h=R.Y)==null||h.dispose();R.Y=void 0;R.api.WG("onOrchestrationLostLeader");R.N=new g.EJ;g.Na(a)})};
g.Q.isOrchestrationLeader=function(){return this.K.B};
g.Q.OF=function(){return g.u(function(R){return R.return(!1)})};
g.Q.qG=function(R){var F=this.B;F.api.publish("offlinetransferpause",R);var h;(h=F.D)==null||h.postMessage(R)};
g.Q.qr=function(R){var F,h;return g.u(function(a){if(a.D==1)return g.m(a,Wo(),2);F=a.B;if(!F)return a.return();h=g.DI(R,"transfer");return g.m(a,VR(F,{mode:"readwrite",qt:!0},function(J){var M=dN(J,h,"transfer"),v=dN(J,g.DI(R,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.Qe.all([M,v]).then(function(I){I=g.N(I);var w=I.next().value;var E=I.next().value;return w&&w.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(w.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Ky(J,w,"transfer").then(function(){GO({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:R,jy:w,offlineModeType:E==null?void 0:E.offlineModeType});return g.Qe.resolve(null)})):g.Qe.resolve(null)})}),0)})};
g.Q.jt=function(R){R=R===void 0?43200:R;var F=this,h,a,J,M,v,I,w,E;return g.u(function(B){if(B.D==1)return F.S.sT()?g.m(B,Wo(),2):B.return(EU4());if(B.D!=3){h=B.B;if(!h)return B.return([]);a=Date.now()/1E3;return g.m(B,co(h,"offlineVideoPolicy"),3)}J=B.B;M=[];v=g.N(J);for(I=v.next();!I.done;I=v.next())w=I.value,Number(w.lastUpdatedTimestampSeconds)+R<=a&&(E=g.lp(w.key).entityId,M.push(E));return M.length?B.return(Dc(F,M,F.C,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):B.return([])})};
g.Q.deleteAll=function(){return Dc(this,["!*$_ALL_ENTITIES_!*$"],this.C,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.Q.refreshAllStaleEntities=function(R){var F=this;return g.u(function(h){return h.D==1?g.m(h,F.jt(R),2):h.return(h.B)})};
g.Q.setUpPositionSyncInterval=function(R){var F=this;this.L!==void 0&&(g.Y$(this.L),this.L=void 0);var h=R!=null?R:864E5;this.L=g.B6(function(){F.Kk(h)},h)};
g.Q.Kk=function(R){var F=this,h,a,J,M,v,I;return g.u(function(w){switch(w.D){case 1:return g.Hi(w,2),g.m(w,es.getInstance(),4);case 4:h=w.B;if(!h)throw Error("prefStorage is undefined");return g.m(w,h.get("psi"),5);case 5:a=w.B;M=((J=a)==null?0:J.zY)?Number(a.zY)/1E3:0;v=Date.now();if(!(M+R<=v)){w.G$(6);break}return g.m(w,Dc(F,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.yn(w,0);break;case 2:I=g.f_(w),an("Offline manager error",I),
g.Na(w)}})};
g.Q.iC=function(){var R=this,F,h,a,J,M,v,I;return g.u(function(w){if(w.D==1)return g.m(w,Wo(),2);if(w.D!=3)return(F=w.B)?g.m(w,co(F,"transfer"),3):w.return([]);h=w.B;a=[];J=g.N(h);for(M=J.next();!M.done;M=J.next())v=M.value,v.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&v.key&&(I=g.lp(v.key).entityId,a.push(I));return w.return(r$9(R,a))})};
g.Q.GC=function(){return g.u(function(R){return R.return([])})};
g.Q.dC=function(){return g.u(function(R){g.Na(R)})};
g.Q.Tj=function(){return g.u(function(R){g.Na(R)})};g.A(YNh,Zc);YNh.prototype.D=function(R){return i$(R)?kiv(this,R):wx(R)?$Eg(this,R):Eh(R)?A$4(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};
var Vy=[10];g.A(TAt,Zc);TAt.prototype.D=function(R){return i$(R)?flL(this,R):wx(R)?jpG(this,R):Eh(R)?ZW4(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};
var qNh=[10];g.A(SN9,Zc);SN9.prototype.D=function(R){return wx(R)?mEv(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};g.A(oUL,l$);g.Q=oUL.prototype;g.Q.HP=function(R){var F=l$.prototype.HP.call(this,R);F.mainVideoEntity=new TAt(R,this.uu,this.B);F.mainPlaylistEntity=new YNh(R,this.uu,this.B);F.mainDownloadsListEntity=new SN9(R,this.uu,this.B);return F};
g.Q.refreshAllStaleEntities=function(R,F){var h=this,a,J,M,v,I,w,E,B,r,Y,p;return g.u(function(k){switch(k.D){case 1:a=[];if(!h.uu.X("web_player_offline_playlist_auto_refresh")){k.G$(2);break}return g.m(k,Xs4(h,R,F),3);case 3:a=k.B;case 2:return g.m(k,es.getInstance(),4);case 4:return J=k.B,g.m(k,(M=J)==null?void 0:M.get("sdois"),5);case 5:return v=k.B,g.m(k,(I=J)==null?void 0:I.get("lmqf"),6);case 6:w=k.B;if(!v){k.G$(7);break}B=a;r=B.concat;return g.m(k,e7e(h,v,(E=w)!=null?E:"SD",R===0),8);case 8:a=
r.call(B,k.B);case 7:return Y=a,p=Y.concat,g.m(k,l$.prototype.refreshAllStaleEntities.call(h,R,F),9);case 9:return a=p.call(Y,k.B),k.return(a)}})};
g.Q.OF=function(R){var F,h,a,J,M,v,I,w;return g.u(function(E){if(E.D==1)return g.m(E,Wo(),2);if(E.D!=3)return(F=E.B)?g.m(E,Cy(F,g.d8,"mainDownloadsListEntity"),3):E.return(!1);h=E.B;if((a=h)==null?0:(J=a.downloads)==null?0:J.length)for(M=g.DI(R,"mainVideoEntity"),v=g.N(h.downloads),I=v.next();!I.done;I=v.next())if(w=I.value,w.videoItem===M)return E.return(!0);return E.return(!1)})};
g.Q.GC=function(){var R=this,F,h,a,J,M,v,I,w;return g.u(function(E){if(E.D==1)return g.m(E,Wo(),2);if(E.D!=3)return(F=E.B)?g.m(E,co(F,"downloadStatusEntity"),3):E.return([]);h=E.B;a=[];J=g.N(h);for(M=J.next();!M.done;M=J.next())v=M.value,v.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&v.key&&(I=g.lp(v.key).entityId,a.push(I));return a.length?(w={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},E.return(Dc(R,a,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
w))):E.return([])})};
g.Q.Tj=function(){var R;return g.u(function(F){return F.D==1?g.m(F,Wo(),2):(R=F.B)?g.m(F,VR(R,{mode:"readwrite",qt:!0},function(h){return Po(h,"mainVideoEntity").then(function(a){var J=[];a=g.N(a);for(var M=a.next();!M.done;M=a.next()){M=M.value;var v=void 0;(v=M.userState)!=null&&v.playbackPosition||(v=g.lp(M.key).entityId,v={key:g.DI(v,"videoPlaybackPositionEntity"),videoId:v,lastPlaybackPositionSeconds:"0"},J.push(Ky(h,v,"videoPlaybackPositionEntity")),M.userState={playbackPosition:v.key},J.push(Ky(h,
M,"mainVideoEntity")))}return g.Qe.all(J)})}),0):F.return()})};
g.Q.dC=function(){var R,F,h,a,J,M,v,I,w,E,B,r,Y,p,k,H,T,Z,b,O,n,K,Rg,U,vi,GI,gL,Em,hf,qa,m2,Ru,ng,$7,eB,ch,Y7,Kg;return g.u(function(hX){if(hX.D==1)return g.m(hX,Wo(),2);if(hX.D!=3){R=hX.B;if(!R)return hX.return();F=g.DI("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.m(hX,VR(R,{mode:"readonly",qt:!0},function(f){return g.Qe.all([dN(f,F,"mainDownloadsListEntity"),dN(f,g.d8,"mainDownloadsListEntity"),Po(f,"mainVideoEntity"),Po(f,"mainPlaylistEntity")])}),3)}h=hX.B;
a=g.N(h);J=a.next().value;M=a.next().value;v=a.next().value;I=a.next().value;w=J;E=M;B=v;r=I;Y=new Set;if((p=w)==null?0:(k=p.downloads)==null?0:k.length)for(H=g.N(w.downloads),T=H.next();!T.done;T=H.next())Z=T.value,b=void 0,(O=(b=Z.videoItem)!=null?b:Z.playlistItem)&&Y.add(O);if((n=E)==null?0:(K=n.downloads)==null?0:K.length)for(Rg=g.N(E.downloads),U=Rg.next();!U.done;U=Rg.next())vi=U.value,vi.videoItem&&Y.add(vi.videoItem);GI=new Set;gL=[];Em=g.N(r);for(hf=Em.next();!hf.done;hf=Em.next()){qa=hf.value;
if(qa.videos)for(m2=g.N(qa.videos),Ru=m2.next();!Ru.done;Ru=m2.next())ng=Ru.value,($7=JSON.parse(g.lp(ng).entityId).videoId)&&GI.add($7);qa.key&&!Y.has(qa.key)&&gL.push(qa.key)}eB=g.N(B);for(ch=eB.next();!ch.done;ch=eB.next())Y7=ch.value,Y7.key&&!Y.has(Y7.key)&&(Kg=g.lp(Y7.key).entityId,GI.has(Kg)||gL.push(Y7.key));return gL.length?g.m(hX,Qjh(R,gL),0):hX.G$(0)})};g.A(nUv,Zc);nUv.prototype.D=function(R){return i$(R)?dE7(this,R):wx(R)?Pyu(this,R):Eh(R)?z76(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};
var CN=[10];g.A(tMk,Zc);tMk.prototype.D=function(R){return i$(R)?DE9(this,R):wx(R)?VM9(this,R):Eh(R)?UEv(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};
var c0=[10];g.A(Wnv,Zc);Wnv.prototype.D=function(R){return i$(R)?aPG(this,R):wx(R)?Jih(this,R):Eh(R)?Mmu(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};
var hi7=[10];g.A(W0,l$);W0.prototype.HP=function(R){var F=l$.prototype.HP.call(this,R);F.musicTrack=new Wnv(R,this.B);F.musicPlaylist=new tMk(R,this.B);F.musicAlbumRelease=new nUv(R,this.B);return F};
W0.prototype.refreshAllStaleEntities=function(R,F){var h=this,a,J,M;return g.u(function(v){if(v.D==1)return g.m(v,g66(h,R,F),2);if(v.D!=3)return J=a=v.B,M=J.concat,g.m(v,l$.prototype.refreshAllStaleEntities.call(h,R,F),3);a=M.call(J,v.B);return v.return(a)})};g.A(Guh,g.Hb);g.Q=Guh.prototype;g.Q.create=function(){var R=this;g.z(this,this.events);if(g.ig(this.uu))this.B=new oUL(this.uu,this.player);else if(g.b5(this.uu)||g.EZ(this.uu))this.B=new W0(this.uu,this.player);this.events.T(this.player,"onPlaybackStartExternal",function(){R.ZK()});
this.events.T(this.player,"videodatachange",function(){R.ZK()});
this.uu.X("html5_offline_playback_position_sync")&&this.events.T(this.player,"presentingplayerstatechange",this.EM)};
g.Q.t5=function(){return!1};
g.Q.gF=function(R,F,h,a){var J=this;return g.u(function(M){return J.B?M.return(Dc(J.B,R,F,h,a)):M.return(Promise.reject())})};
g.Q.deleteAll=function(){return this.B.deleteAll()};
g.Q.jt=function(R){return this.B.jt(R)};
g.Q.refreshAllStaleEntities=function(R){return this.B.refreshAllStaleEntities(R)};
g.Q.setUpPositionSyncInterval=function(R){this.B.setUpPositionSyncInterval(R)};
g.Q.qG=function(R){this.B.qG(R)};
g.Q.qr=function(R){return this.B.qr(R)};
g.Q.ZK=function(){var R=this,F;return g.u(function(h){F=R.player.getVideoData();return g.MX(F)?IP7(F)&&R.D!==F.clientPlaybackNonce?g.m(h,ip7(R,F),0):h.G$(0):h.return()})};
g.Q.EM=function(R){var F=this,h,a,J,M,v,I,w;return g.u(function(E){if(E.D==1)return h=F.player.getVideoData(),a=h.FW,g.i5(R,2)||g.i5(R,512)?g.m(E,Wo(),2):E.return();if(E.D!=3){J=E.B;if(!J)return an("PES is undefined"),E.return();M=h.videoId;return g.m(E,Cy(J,g.DI(M,"mainVideoEntity"),"mainVideoEntity"),3)}v=E.B;if(!v)return E.return();I=Math.floor(a).toString();w={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:I}};return g.m(E,F.gF([M],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
w),0)})};
g.Q.isOrchestrationLeader=function(){return this.B.isOrchestrationLeader()};
g.Q.updateDownloadState=function(R,F){var h,a,J,M;return g.u(function(v){if(v.D==1)return g.m(v,Wo(),2);h=v.B;if(!h)return an("PES is undefined"),v.return();a=g.lp(R);J=a.entityType;M=a.entityId;return g.m(v,B0(M,J,h,F,!0),0)})};g.NO("offline",Guh);})(_yt_player);
